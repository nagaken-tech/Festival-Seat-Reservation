{\rtf1\ansi\ansicpg932\cocoartf2867
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 Menlo-Regular;}
{\colortbl;\red255\green255\blue255;\red20\green67\blue174;\red246\green247\blue249;\red46\green49\blue51;
\red24\green25\blue27;\red162\green0\blue16;\red186\green6\blue115;\red77\green80\blue85;\red18\green115\blue126;
\red21\green98\blue39;\red97\green3\blue173;}
{\*\expandedcolortbl;;\cssrgb\c9412\c35294\c73725;\cssrgb\c97255\c97647\c98039;\cssrgb\c23529\c25098\c26275;
\cssrgb\c12549\c12941\c14118;\cssrgb\c70196\c7843\c7059;\cssrgb\c78824\c15294\c52549;\cssrgb\c37255\c38824\c40784;\cssrgb\c3529\c52157\c56863;
\cssrgb\c7451\c45098\c20000;\cssrgb\c46275\c15294\c73333;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf2 \cb3 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 doGet\cf4 \strokec4 (\cf5 \strokec5 e\cf4 \strokec4 ) \{ \cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 page\cf4 \strokec4  = \cf6 \strokec6 ''\cf4 \strokec4 ;\cb1 \
\cb3   \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 e\cf4 \strokec4  && \cf5 \strokec5 e\cf4 \strokec4 .\cf5 \strokec5 parameter\cf4 \strokec4  && \cf5 \strokec5 e\cf4 \strokec4 .\cf5 \strokec5 parameter\cf4 \strokec4 .\cf5 \strokec5 page\cf4 \strokec4 ) \{ \cb1 \
\cb3     \cf5 \strokec5 page\cf4 \strokec4  = \cf5 \strokec5 e\cf4 \strokec4 .\cf5 \strokec5 parameter\cf4 \strokec4 .\cf5 \strokec5 page\cf4 \strokec4 ;\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 page\cf4 \strokec4  === \cf6 \strokec6 'printer'\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \cf7 \strokec7 HtmlService\cf4 \strokec4 .\cf5 \strokec5 createTemplateFromFile\cf4 \strokec4 (\cf6 \strokec6 'TicketPrinter'\cf4 \strokec4 ).\cf5 \strokec5 evaluate\cf4 \strokec4 ()\cb1 \
\cb3         .\cf5 \strokec5 setXFrameOptionsMode\cf4 \strokec4 (\cf7 \strokec7 HtmlService\cf4 \strokec4 .\cf7 \strokec7 XFrameOptionsMode\cf4 \strokec4 .\cf7 \strokec7 ALLOWALL\cf4 \strokec4 );\cb1 \
\cb3   \} \cf2 \strokec2 else\cf4 \strokec4  \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 page\cf4 \strokec4  === \cf6 \strokec6 'secondfloor'\cf4 \strokec4 ) \{ \cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \cf7 \strokec7 HtmlService\cf4 \strokec4 .\cf5 \strokec5 createTemplateFromFile\cf4 \strokec4 (\cf6 \strokec6 'SecondFloorDist'\cf4 \strokec4 ).\cf5 \strokec5 evaluate\cf4 \strokec4 () \cb1 \
\cb3         .\cf5 \strokec5 setXFrameOptionsMode\cf4 \strokec4 (\cf7 \strokec7 HtmlService\cf4 \strokec4 .\cf7 \strokec7 XFrameOptionsMode\cf4 \strokec4 .\cf7 \strokec7 ALLOWALL\cf4 \strokec4 );\cb1 \
\cb3   \} \cf2 \strokec2 else\cf4 \strokec4  \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 page\cf4 \strokec4  === \cf6 \strokec6 'sameday'\cf4 \strokec4 ) \{ \cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \cf7 \strokec7 HtmlService\cf4 \strokec4 .\cf5 \strokec5 createTemplateFromFile\cf4 \strokec4 (\cf6 \strokec6 'SameDayTicket'\cf4 \strokec4 ).\cf5 \strokec5 evaluate\cf4 \strokec4 () \cb1 \
\cb3         .\cf5 \strokec5 setXFrameOptionsMode\cf4 \strokec4 (\cf7 \strokec7 HtmlService\cf4 \strokec4 .\cf7 \strokec7 XFrameOptionsMode\cf4 \strokec4 .\cf7 \strokec7 ALLOWALL\cf4 \strokec4 );\cb1 \
\cb3   \} \cf2 \strokec2 else\cf4 \strokec4  \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 page\cf4 \strokec4  === \cf6 \strokec6 'printables'\cf4 \strokec4 ) \{ \cf8 \strokec8 // \uc0\u9733 \u12371 \u12371 \u12364 \u36861 \u21152 \u12373 \u12428 \u12414 \u12375 \u12383 \u9733 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \cf7 \strokec7 HtmlService\cf4 \strokec4 .\cf5 \strokec5 createTemplateFromFile\cf4 \strokec4 (\cf6 \strokec6 'PrintableTickets'\cf4 \strokec4 ).\cf5 \strokec5 evaluate\cf4 \strokec4 () \cb1 \
\cb3         .\cf5 \strokec5 setXFrameOptionsMode\cf4 \strokec4 (\cf7 \strokec7 HtmlService\cf4 \strokec4 .\cf7 \strokec7 XFrameOptionsMode\cf4 \strokec4 .\cf7 \strokec7 ALLOWALL\cf4 \strokec4 );\cb1 \
\cb3   \} \cf2 \strokec2 else\cf4 \strokec4  \{\cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \cf7 \strokec7 HtmlService\cf4 \strokec4 .\cf5 \strokec5 createTemplateFromFile\cf4 \strokec4 (\cf6 \strokec6 'Index'\cf4 \strokec4 ).\cf5 \strokec5 evaluate\cf4 \strokec4 ()\cb1 \
\cb3         .\cf5 \strokec5 setXFrameOptionsMode\cf4 \strokec4 (\cf7 \strokec7 HtmlService\cf4 \strokec4 .\cf7 \strokec7 XFrameOptionsMode\cf4 \strokec4 .\cf7 \strokec7 ALLOWALL\cf4 \strokec4 );\cb1 \
\cb3   \}\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 getReservedSeats\cf4 \strokec4 () \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 sheet\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 getSheetByName\cf4 \strokec4 (\cf6 \strokec6 'Reservations'\cf4 \strokec4 ); \cb1 \
\
\cb3   \cf2 \strokec2 if\cf4 \strokec4  (!\cf5 \strokec5 sheet\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 throw\cf4 \strokec4  \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf6 \strokec6 '\uc0\u25351 \u23450 \u12373 \u12428 \u12383 \u12471 \u12540 \u12488 \u12300 Reservations\u12301 \u12364 \u35211 \u12388 \u12363 \u12426 \u12414 \u12379 \u12435 \u12391 \u12375 \u12383 \u12290 \u12471 \u12540 \u12488 \u21517 \u12434 \u30906 \u35469 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 \\n\u12362 \u25163 \u25968 \u12391 \u12377 \u12364 \u35352 \u24565 \u31085 \u29983 \u24466 \u36939 \u21942 \u26412 \u37096 \u12395 \u12496 \u12464 \u22577 \u21578 \u12434 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 '\cf4 \strokec4 );\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 data\cf4 \strokec4  = \cf5 \strokec5 sheet\cf4 \strokec4 .\cf5 \strokec5 getDataRange\cf4 \strokec4 ().\cf5 \strokec5 getValues\cf4 \strokec4 ();\cb1 \
\cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 reserved\cf4 \strokec4  = [];\cb1 \
\cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 reservedIds\cf4 \strokec4  = []; \cb1 \
\cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 issuedIds\cf4 \strokec4  = []; \cb1 \
\
\cb3   \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 i\cf4 \strokec4  = \cf9 \strokec9 1\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4  < \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 length\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 seats\cf4 \strokec4  = \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 6\cf4 \strokec4 ]; \cb1 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 seats\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 seatParts\cf4 \strokec4  = \cf5 \strokec5 seats\cf4 \strokec4 .\cf5 \strokec5 split\cf4 \strokec4 (\cf6 \strokec6 ','\cf4 \strokec4 ); \cb1 \
\cb3       \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 j\cf4 \strokec4  = \cf9 \strokec9 0\cf4 \strokec4 ; \cf5 \strokec5 j\cf4 \strokec4  < \cf5 \strokec5 seatParts\cf4 \strokec4 .\cf5 \strokec5 length\cf4 \strokec4 ; \cf5 \strokec5 j\cf4 \strokec4 ++) \{\cb1 \
\cb3         \cf5 \strokec5 reserved\cf4 \strokec4 .\cf5 \strokec5 push\cf4 \strokec4 (\cf5 \strokec5 seatParts\cf4 \strokec4 [\cf5 \strokec5 j\cf4 \strokec4 ].\cf5 \strokec5 trim\cf4 \strokec4 ());\cb1 \
\cb3       \}\cb1 \
\cb3     \}\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 studentId\cf4 \strokec4  = \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 3\cf4 \strokec4 ]; \cb1 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 studentId\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf5 \strokec5 reservedIds\cf4 \strokec4 .\cf5 \strokec5 push\cf4 \strokec4 (\cf5 \strokec5 studentId\cf4 \strokec4 .\cf5 \strokec5 toString\cf4 \strokec4 ().\cf5 \strokec5 trim\cf4 \strokec4 ().\cf5 \strokec5 toUpperCase\cf4 \strokec4 ());\cb1 \
\cb3     \}\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 isIssued\cf4 \strokec4  = \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 7\cf4 \strokec4 ]; \cb1 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 isIssued\cf4 \strokec4  === \cf2 \strokec2 true\cf4 \strokec4  || \cf7 \strokec7 String\cf4 \strokec4 (\cf5 \strokec5 isIssued\cf4 \strokec4 ).\cf5 \strokec5 toUpperCase\cf4 \strokec4 () === \cf6 \strokec6 'TRUE'\cf4 \strokec4 ) \{ \cb1 \
\cb3         \cf5 \strokec5 issuedIds\cf4 \strokec4 .\cf5 \strokec5 push\cf4 \strokec4 (\cf5 \strokec5 studentId\cf4 \strokec4 .\cf5 \strokec5 toString\cf4 \strokec4 ().\cf5 \strokec5 trim\cf4 \strokec4 ().\cf5 \strokec5 toUpperCase\cf4 \strokec4 ());\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\cb3   \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 reservedSeats\cf4 \strokec4 : \cf5 \strokec5 reserved\cf4 \strokec4 , \cf5 \strokec5 reservedIds\cf4 \strokec4 : \cf5 \strokec5 reservedIds\cf4 \strokec4 , \cf5 \strokec5 issuedIds\cf4 \strokec4 : \cf5 \strokec5 issuedIds\cf4 \strokec4  \}; \cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf8 \cb3 \strokec8 // \uc0\u12304 \u39640 \u36895 \u29256 \u12305 PDF\u29983 \u25104 \u20966 \u29702 \u12434 \u20998 \u38626 \u12375 \u12383 \u20104 \u32004 \u38306 \u25968 \cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 submitReservation\cf4 \strokec4 (\cf5 \strokec5 data\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 lock\cf4 \strokec4  = \cf7 \strokec7 LockService\cf4 \strokec4 .\cf5 \strokec5 getScriptLock\cf4 \strokec4 ();\cb1 \
\cb3   \cf2 \strokec2 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf5 \strokec5 lock\cf4 \strokec4 .\cf5 \strokec5 waitLock\cf4 \strokec4 (\cf9 \strokec9 5000\cf4 \strokec4 ); \cb1 \
\cb3   \} \cf2 \strokec2 catch\cf4 \strokec4  (\cf5 \strokec5 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 throw\cf4 \strokec4  \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf6 \strokec6 "\uc0\u29694 \u22312 \u12289 \u20182 \u12398 \u20104 \u32004 \u20966 \u29702 \u20013 \u12391 \u12377 \u12290 \u24656 \u12428 \u20837 \u12426 \u12414 \u12377 \u12364 \u12289 \u12418 \u12358 \u19968 \u24230 \u12362 \u35430 \u12375 \u12367 \u12384 \u12373 \u12356 \u12290 "\cf4 \strokec4 );\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 sheet\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 getSheetByName\cf4 \strokec4 (\cf6 \strokec6 'Reservations'\cf4 \strokec4 ); \cb1 \
\cb3     \cb1 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (!\cf5 \strokec5 sheet\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf2 \strokec2 throw\cf4 \strokec4  \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf6 \strokec6 '\uc0\u12471 \u12540 \u12488 \u12300 Reservations\u12301 \u12364 \u35211 \u12388 \u12363 \u12426 \u12414 \u12379 \u12435 \u12391 \u12375 \u12383 \u12290 \u12471 \u12540 \u12488 \u21517 \u12434 \u30906 \u35469 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 \\n\u12362 \u25163 \u25968 \u12391 \u12377 \u12364 \u35352 \u24565 \u31085 \u29983 \u24466 \u36939 \u21942 \u26412 \u37096 \u12395 \u12496 \u12464 \u22577 \u21578 \u12434 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 '\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 currentData\cf4 \strokec4  = \cf5 \strokec5 getReservedSeats\cf4 \strokec4 (); \cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 currentReservedSeats\cf4 \strokec4  = \cf5 \strokec5 currentData\cf4 \strokec4 .\cf5 \strokec5 reservedSeats\cf4 \strokec4 ;\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 currentDataIdsUpper\cf4 \strokec4  = \cf5 \strokec5 currentData\cf4 \strokec4 .\cf5 \strokec5 reservedIds\cf4 \strokec4 .\cf5 \strokec5 map\cf4 \strokec4 (\cf5 \strokec5 id\cf4 \strokec4  => \cf5 \strokec5 id\cf4 \strokec4 .\cf5 \strokec5 toUpperCase\cf4 \strokec4 ());\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 currentIssuedIdsUpper\cf4 \strokec4  = \cf5 \strokec5 currentData\cf4 \strokec4 .\cf5 \strokec5 issuedIds\cf4 \strokec4 .\cf5 \strokec5 map\cf4 \strokec4 (\cf5 \strokec5 id\cf4 \strokec4  => \cf5 \strokec5 id\cf4 \strokec4 .\cf5 \strokec5 toUpperCase\cf4 \strokec4 ());\cb1 \
\
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 currentDataIdsUpper\cf4 \strokec4 .\cf5 \strokec5 includes\cf4 \strokec4 (\cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 id\cf4 \strokec4 .\cf5 \strokec5 toUpperCase\cf4 \strokec4 ())) \{\cb1 \
\cb3       \cf2 \strokec2 throw\cf4 \strokec4  \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf6 \strokec6 '\uc0\u12371 \u12398 \u23398 \u31821 \u30058 \u21495  ('\cf4 \strokec4  + \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 id\cf4 \strokec4  + \cf6 \strokec6 ') \uc0\u12399 \u26082 \u12395 \u20104 \u32004 \u28168 \u12415 \u12391 \u12377 \u12290 '\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 currentIssuedIdsUpper\cf4 \strokec4 .\cf5 \strokec5 includes\cf4 \strokec4 (\cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 id\cf4 \strokec4 .\cf5 \strokec5 toUpperCase\cf4 \strokec4 ())) \{\cb1 \
\cb3       \cf2 \strokec2 throw\cf4 \strokec4  \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf6 \strokec6 '\uc0\u12371 \u12398 \u23398 \u31821 \u30058 \u21495  ('\cf4 \strokec4  + \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 id\cf4 \strokec4  + \cf6 \strokec6 ') \uc0\u12399 \u26082 \u12395 \u30330 \u21048 \u28168 \u12415 \u12391 \u12377 \u12290 '\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 k\cf4 \strokec4  = \cf9 \strokec9 0\cf4 \strokec4 ; \cf5 \strokec5 k\cf4 \strokec4  < \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 seats\cf4 \strokec4 .\cf5 \strokec5 length\cf4 \strokec4 ; \cf5 \strokec5 k\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 seat\cf4 \strokec4  = \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 seats\cf4 \strokec4 [\cf5 \strokec5 k\cf4 \strokec4 ];\cb1 \
\cb3       \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 currentReservedSeats\cf4 \strokec4 .\cf5 \strokec5 includes\cf4 \strokec4 (\cf5 \strokec5 seat\cf4 \strokec4 )) \{ \cb1 \
\cb3         \cf2 \strokec2 throw\cf4 \strokec4  \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf6 \strokec6 '\uc0\u36984 \u25246 \u12373 \u12428 \u12383 \u24231 \u24109  ('\cf4 \strokec4  + \cf5 \strokec5 seat\cf4 \strokec4  + \cf6 \strokec6 ') \uc0\u12399 \u12377 \u12391 \u12395 \u20104 \u32004 \u12373 \u12428 \u12390 \u12356 \u12414 \u12377 \u12290 \u20182 \u12398 \u24231 \u24109 \u12434 \u36984 \u25246 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 '\cf4 \strokec4 );\cb1 \
\cb3       \}\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf8 \strokec8 // \uc0\u9660 \u9660 \u9660  \u22793 \u26356 \u28857  \u9660 \u9660 \u9660 \cf4 \cb1 \strokec4 \
\cb3     \cf8 \strokec8 // I\uc0\u21015 \u12395 \u12300 PDF\u20316 \u25104 \u29366 \u27841 \u12301 \u12434 \u35352 \u37682 \u12377 \u12427 \u12383 \u12417 \u12289 \u26368 \u24460 \u12395  false \u12434 \u19968 \u12388 \u36861 \u21152 \u12375 \u12414 \u12377 \cf4 \cb1 \strokec4 \
\cb3     \cf5 \strokec5 sheet\cf4 \strokec4 .\cf5 \strokec5 appendRow\cf4 \strokec4 ([\cb1 \
\cb3       \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Date\cf4 \strokec4 (),\cb1 \
\cb3       \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 grade\cf4 \strokec4 ,\cb1 \
\cb3       \cf5 \strokec5 data\cf4 \strokec4 .\cf2 \strokec2 class\cf4 \strokec4 ,\cb1 \
\cb3       \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 id\cf4 \strokec4 ,\cb1 \
\cb3       \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 name\cf4 \strokec4 ,\cb1 \
\cb3       \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 count\cf4 \strokec4 ,\cb1 \
\cb3       \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 seats\cf4 \strokec4 .\cf5 \strokec5 join\cf4 \strokec4 (\cf6 \strokec6 ','\cf4 \strokec4 ),\cb1 \
\cb3       \cf2 \strokec2 false\cf4 \strokec4 , \cf8 \strokec8 // H\uc0\u21015 : \u30330 \u21048 \u28168 \u12415 \u12501 \u12521 \u12464 \cf4 \cb1 \strokec4 \
\cb3       \cf2 \strokec2 false\cf4 \strokec4   \cf8 \strokec8 // I\uc0\u21015 : PDF\u20316 \u25104 \u28168 \u12415 \u12501 \u12521 \u12464 \cf4 \cb1 \strokec4 \
\cb3     ]);\cb1 \
\cb3     \cf8 \strokec8 // \uc0\u9650 \u9650 \u9650  \u22793 \u26356 \u28857  \u9650 \u9650 \u9650 \cf4 \cb1 \strokec4 \
\
\cb3     \cf8 \strokec8 // \uc0\u9660 \u9660 \u9660  \u22793 \u26356 \u28857  \u9660 \u9660 \u9660 \cf4 \cb1 \strokec4 \
\cb3     \cf8 \strokec8 // \uc0\u26178 \u38291 \u12398 \u12363 \u12363 \u12427 PDF\u29983 \u25104 \u20966 \u29702 \u12399 \u12371 \u12371 \u12363 \u12425 \u21066 \u38500 \u12375 \u12414 \u12377 \cf4 \cb1 \strokec4 \
\cb3     \cf8 \strokec8 // generateTicketPdf(data.id);\cf4 \cb1 \strokec4 \
\cb3     \cf8 \strokec8 // \uc0\u9650 \u9650 \u9650  \u22793 \u26356 \u28857  \u9650 \u9650 \u9650 \cf4 \cb1 \strokec4 \
\
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 email\cf4 \strokec4  = \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 id\cf4 \strokec4  + \cf6 \strokec6 \'91@********.**\'92\cf4 \strokec4 ;\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 subject\cf4 \strokec4  = \cf6 \strokec6 '\uc0\u31532 1\u22238 FunFestival\u12288 \u24231 \u24109 \u20104 \u32004 \u23436 \u20102 \u12398 \u12362 \u30693 \u12425 \u12379 '\cf4 \strokec4 ;\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 body\cf4 \strokec4  = \cb1 \
\cb3       \cf6 \strokec6 '\uc0\u31532 \u65297 \u22238 FunFestival\u12395 \u12388 \u12365 \u12414 \u12375 \u12390 \u12289 \u20197 \u19979 \u12398 \u20869 \u23481 \u12391 \u24231 \u24109 \u25351 \u23450 \u12539 \u20104 \u32004 \u12434 \u25215 \u12426 \u12414 \u12375 \u12383 \u12290 \\n\\n'\cf4 \strokec4  +\cb1 \
\cb3       \cf6 \strokec6 '-- \uc0\u20104 \u32004 \u20869 \u23481  --\\n'\cf4 \strokec4  +\cb1 \
\cb3       \cf6 \strokec6 '\uc0\u23398 \u24180 : '\cf4 \strokec4  + \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 grade\cf4 \strokec4  + \cf6 \strokec6 '\\n'\cf4 \strokec4  +\cb1 \
\cb3       \cf6 \strokec6 '\uc0\u12463 \u12521 \u12473 : '\cf4 \strokec4  + \cf5 \strokec5 data\cf4 \strokec4 .\cf2 \strokec2 class\cf4 \strokec4  + \cf6 \strokec6 '\\n'\cf4 \strokec4  +\cb1 \
\cb3       \cf6 \strokec6 '\uc0\u23398 \u31821 \u30058 \u21495 : '\cf4 \strokec4  + \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 id\cf4 \strokec4  + \cf6 \strokec6 '\\n'\cf4 \strokec4  +\cb1 \
\cb3       \cf6 \strokec6 '\uc0\u21517 \u21069 : '\cf4 \strokec4  + \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 name\cf4 \strokec4  + \cf6 \strokec6 '\\n'\cf4 \strokec4  +\cb1 \
\cb3       \cf6 \strokec6 '\uc0\u20104 \u32004 \u24231 \u24109 : '\cf4 \strokec4  + \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 seats\cf4 \strokec4 .\cf5 \strokec5 join\cf4 \strokec4 (\cf6 \strokec6 ', '\cf4 \strokec4 ) + \cf6 \strokec6 '\\n\\n'\cf4 \strokec4  +\cb1 \
\cb3       \cf6 \strokec6 '\uc0\u12461 \u12515 \u12531 \u12475 \u12523 \u12539 \u20154 \u25968 \u22793 \u26356 \u12539 \u20837 \u21147 \u38291 \u36949 \u12356 \u12434 \u12375 \u12383 \u22580 \u21512 \u12399 \u12289 \\n'\cf4 \strokec4  +\cb1 \
\cb3       \cf6 \strokec6 \'91*******@******.**\uc0\u12395 \u21839 \u12356 \u21512 \u12431 \u12379 \u12427 \u12363 \u12289 \\n'\cf4 \strokec4  +\cb1 \
\cb3       \cf6 \strokec6 \'91*********\uc0\u12398 \u12392 \u12371 \u12429 \u12395 \u30452 \u25509 \u12362 \u36234 \u12375 \u12367 \u12384 \u12373 \u12356 \u12290 \\n\\n'\cf4 \strokec4  +\cb1 \
\cb3       \cf6 \strokec6 '\uc0\u30330 \u21048 \u26041 \u27861 \u12394 \u12393 \u35443 \u12375 \u12356 \u20869 \u23481 \u12395 \u12388 \u12365 \u12414 \u12375 \u12390 \u12399 \u12289 \u29983 \u24466 \u20250 Classroom\u12394 \u12393 \u12391 \u12372 \u26696 \u20869 \u12356 \u12383 \u12375 \u12414 \u12377 \u12290 '\cf4 \strokec4 ;\cb1 \
\cb3     \cb1 \
\cb3     \cf7 \strokec7 MailApp\cf4 \strokec4 .\cf5 \strokec5 sendEmail\cf4 \strokec4 (\cf5 \strokec5 email\cf4 \strokec4 , \cf5 \strokec5 subject\cf4 \strokec4 , \cf5 \strokec5 body\cf4 \strokec4 ); \cb1 \
\
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \cf6 \strokec6 "\uc0\u20107 \u21069 \u20104 \u32004 \u21463 \u20184 \u12434 \u25215 \u12426 \u12414 \u12375 \u12383 \u65281 \\n\u12513 \u12540 \u12523 \u12434 \u23398 \u26657 \u12398 \u12513 \u12540 \u12523 \u12450 \u12489 \u12524 \u12473 \u23451 \u12395 \u36865 \u20449 \u12375 \u12414 \u12375 \u12383 \u12290 \\n\u23626 \u12363 \u12394 \u12356 \u22580 \u21512 \u12399 \u12289 \u12362 \u36817 \u12367 \u12398 \u35352 \u24565 \u31085 \u29983 \u24466 \u36939 \u21942 \u26412 \u37096 \u24441 \u21729 \u12395 \u12362 \u21839 \u12356 \u21512 \u12431 \u12379 \u12367 \u12384 \u12373 \u12356 \u12290 "\cf4 \strokec4 ;\cb1 \
\cb3   \} \cf2 \strokec2 catch\cf4 \strokec4  (\cf5 \strokec5 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 throw\cf4 \strokec4  \cf5 \strokec5 e\cf4 \strokec4 ;\cb1 \
\cb3   \} \cf2 \strokec2 finally\cf4 \strokec4  \{\cb1 \
\cb3     \cf5 \strokec5 lock\cf4 \strokec4 .\cf5 \strokec5 releaseLock\cf4 \strokec4 ();\cb1 \
\cb3   \}\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf10 \cb3 \strokec10 /**\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * \uc0\u23398 \u31821 \u30058 \u21495 \u12395 \u22522 \u12389 \u12356 \u12390 \u20104 \u32004 \u24773 \u22577 \u12434 \u26908 \u32034 \u12375 \u12289 \u12481 \u12465 \u12483 \u12488 HTML\u12434 \u36820 \u12375 \u12414 \u12377 \u12290 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * \uc0\u12371 \u12398 \u38306 \u25968 \u12399 \u12471 \u12540 \u12488 \u12398 \u12300 \u30330 \u21048 \u28168 \u12415 \u12301 \u12473 \u12486 \u12540 \u12479 \u12473 \u12434 \u26356 \u26032 \u12375 \u12414 \u12379 \u12435 \u12290 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * @param \{string\} studentId - \uc0\u26908 \u32034 \u12377 \u12427 \u23398 \u31821 \u30058 \u21495 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * @returns \{object\} status, message, ticketHtml (\uc0\u20104 \u32004 \u12364 \u35211 \u12388 \u12363 \u12387 \u12383 \u22580 \u21512 ) \u12414 \u12383 \u12399  isIssued (\u30330 \u21048 \u28168 \u12415 \u12398 \u22580 \u21512 ) \u12434 \u21547 \u12416 \u12458 \u12502 \u12472 \u12455 \u12463 \u12488 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 searchReservationInfo\cf4 \strokec4 (\cf5 \strokec5 studentId\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 lock\cf4 \strokec4  = \cf7 \strokec7 LockService\cf4 \strokec4 .\cf5 \strokec5 getScriptLock\cf4 \strokec4 ();\cb1 \
\cb3   \cf2 \strokec2 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf5 \strokec5 lock\cf4 \strokec4 .\cf5 \strokec5 waitLock\cf4 \strokec4 (\cf9 \strokec9 5000\cf4 \strokec4 ); \cb1 \
\cb3   \} \cf2 \strokec2 catch\cf4 \strokec4  (\cf5 \strokec5 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 "\uc0\u29694 \u22312 \u12289 \u20182 \u12398 \u20966 \u29702 \u20013 \u12391 \u12377 \u12290 \u24656 \u12428 \u20837 \u12426 \u12414 \u12377 \u12364 \u12289 \u12418 \u12358 \u19968 \u24230 \u12362 \u35430 \u12375 \u12367 \u12384 \u12373 \u12356 \u12290 "\cf4 \strokec4  \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 sheet\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 getSheetByName\cf4 \strokec4 (\cf6 \strokec6 'Reservations'\cf4 \strokec4 ); \cb1 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (!\cf5 \strokec5 sheet\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf2 \strokec2 throw\cf4 \strokec4  \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf6 \strokec6 '\uc0\u12471 \u12540 \u12488 \u12300 Reservations\u12301 \u12364 \u35211 \u12388 \u12363 \u12426 \u12414 \u12379 \u12435 \u12391 \u12375 \u12383 \u12290 \u12471 \u12540 \u12488 \u21517 \u12434 \u30906 \u35469 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 '\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 data\cf4 \strokec4  = \cf5 \strokec5 sheet\cf4 \strokec4 .\cf5 \strokec5 getDataRange\cf4 \strokec4 ().\cf5 \strokec5 getValues\cf4 \strokec4 ();\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 reservation\cf4 \strokec4  = \cf2 \strokec2 null\cf4 \strokec4 ; \cb1 \
\
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 searchStudentIdUpper\cf4 \strokec4  = \cf5 \strokec5 studentId\cf4 \strokec4 .\cf5 \strokec5 toUpperCase\cf4 \strokec4 ();\cb1 \
\
\cb3     \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 i\cf4 \strokec4  = \cf9 \strokec9 1\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4  < \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 length\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 3\cf4 \strokec4 ].\cf5 \strokec5 toString\cf4 \strokec4 ().\cf5 \strokec5 toUpperCase\cf4 \strokec4 () === \cf5 \strokec5 searchStudentIdUpper\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf5 \strokec5 reservation\cf4 \strokec4  = \{\cb1 \
\cb3           \cf5 \strokec5 date\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 0\cf4 \strokec4 ],\cb1 \
\cb3           \cf5 \strokec5 grade\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 1\cf4 \strokec4 ],\cb1 \
\cb3           \cf2 \strokec2 class\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 2\cf4 \strokec4 ],\cb1 \
\cb3           \cf5 \strokec5 id\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 3\cf4 \strokec4 ],\cb1 \
\cb3           \cf5 \strokec5 name\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 4\cf4 \strokec4 ],\cb1 \
\cb3           \cf5 \strokec5 count\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 5\cf4 \strokec4 ],\cb1 \
\cb3           \cf5 \strokec5 seats\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 6\cf4 \strokec4 ].\cf5 \strokec5 split\cf4 \strokec4 (\cf6 \strokec6 ','\cf4 \strokec4 ).\cf5 \strokec5 map\cf4 \strokec4 (\cf5 \strokec5 s\cf4 \strokec4  => \cf5 \strokec5 s\cf4 \strokec4 .\cf5 \strokec5 trim\cf4 \strokec4 ()),\cb1 \
\cb3           \cf5 \strokec5 isIssued\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 7\cf4 \strokec4 ] \cf8 \strokec8 // \uc0\u30330 \u21048 \u28168 \u12415 \u12501 \u12521 \u12464 \u12418 \u21462 \u24471 \cf4 \cb1 \strokec4 \
\cb3         \};\cb1 \
\cb3         \cf2 \strokec2 break\cf4 \strokec4 ;\cb1 \
\cb3       \}\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (!\cf5 \strokec5 reservation\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u23398 \u31821 \u30058 \u21495  '\cf4 \strokec4  + \cf5 \strokec5 studentId\cf4 \strokec4  + \cf6 \strokec6 ' \uc0\u12398 \u20104 \u32004 \u12399 \u35211 \u12388 \u12363 \u12426 \u12414 \u12379 \u12435 \u12391 \u12375 \u12383 \u12290 '\cf4 \strokec4  \};\cb1 \
\cb3     \}\cb1 \
\cb3     \cb1 \
\cb3     \cf8 \strokec8 // \uc0\u30330 \u21048 \u28168 \u12415 \u12398 \u22580 \u21512 \u12399 \u12289 \u12381 \u12398 \u24773 \u22577 \u12392 \u12513 \u12483 \u12475 \u12540 \u12472 \u12434 \u36820 \u12377 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 isIssued\cf4 \strokec4  === \cf2 \strokec2 true\cf4 \strokec4  || \cf7 \strokec7 String\cf4 \strokec4 (\cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 isIssued\cf4 \strokec4 ).\cf5 \strokec5 toUpperCase\cf4 \strokec4 () === \cf6 \strokec6 'TRUE'\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'issued'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u12371 \u12398 \u23398 \u31821 \u30058 \u21495  ('\cf4 \strokec4  + \cf5 \strokec5 studentId\cf4 \strokec4  + \cf6 \strokec6 ') \uc0\u12398 \u12481 \u12465 \u12483 \u12488 \u12399 \u26082 \u12395 \u30330 \u21048 \u28168 \u12415 \u12391 \u12377 \u12290 '\cf4 \strokec4 , \cf5 \strokec5 ticketHtml\cf4 \strokec4 : \cf5 \strokec5 generateTicketHtml\cf4 \strokec4 (\cf5 \strokec5 reservation\cf4 \strokec4 ) \};\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf8 \strokec8 // \uc0\u26410 \u30330 \u21048 \u12398 \u22580 \u21512 \u12399 \u12289 \u20104 \u32004 \u24773 \u22577 \u12434 \u36820 \u12377 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 ticketHtml\cf4 \strokec4  = \cf5 \strokec5 generateTicketHtml\cf4 \strokec4 (\cf5 \strokec5 reservation\cf4 \strokec4 );\cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'success'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u20104 \u32004 \u24773 \u22577 \u12434 \u30906 \u35469 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 '\cf4 \strokec4 , \cf5 \strokec5 ticketHtml\cf4 \strokec4 : \cf5 \strokec5 ticketHtml\cf4 \strokec4  \};\cb1 \
\
\cb3   \} \cf2 \strokec2 catch\cf4 \strokec4  (\cf5 \strokec5 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf5 \strokec5 e\cf4 \strokec4 .\cf5 \strokec5 message\cf4 \strokec4  \};\cb1 \
\cb3   \} \cf2 \strokec2 finally\cf4 \strokec4  \{\cb1 \
\cb3     \cf5 \strokec5 lock\cf4 \strokec4 .\cf5 \strokec5 releaseLock\cf4 \strokec4 ();\cb1 \
\cb3   \}\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf10 \cb3 \strokec10 /**\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * \uc0\u25351 \u23450 \u12373 \u12428 \u12383 \u23398 \u31821 \u30058 \u21495 \u12398 \u20104 \u32004 \u12434 \u12300 \u30330 \u21048 \u28168 \u12415 \u12301 \u12395 \u12510 \u12540 \u12463 \u12375 \u12414 \u12377 \u12290 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * @param \{string\} studentId - \uc0\u30330 \u21048 \u28168 \u12415 \u12395 \u12377 \u12427 \u23398 \u31821 \u30058 \u21495 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * @returns \{object\} status, message \uc0\u12434 \u21547 \u12416 \u12458 \u12502 \u12472 \u12455 \u12463 \u12488 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 markTicketAsIssued\cf4 \strokec4 (\cf5 \strokec5 studentId\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 lock\cf4 \strokec4  = \cf7 \strokec7 LockService\cf4 \strokec4 .\cf5 \strokec5 getScriptLock\cf4 \strokec4 ();\cb1 \
\cb3   \cf2 \strokec2 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf5 \strokec5 lock\cf4 \strokec4 .\cf5 \strokec5 waitLock\cf4 \strokec4 (\cf9 \strokec9 5000\cf4 \strokec4 ); \cb1 \
\cb3   \} \cf2 \strokec2 catch\cf4 \strokec4  (\cf5 \strokec5 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 "\uc0\u29694 \u22312 \u12289 \u20182 \u12398 \u20966 \u29702 \u20013 \u12391 \u12377 \u12290 \u24656 \u12428 \u20837 \u12426 \u12414 \u12377 \u12364 \u12289 \u12418 \u12358 \u19968 \u24230 \u12362 \u35430 \u12375 \u12367 \u12384 \u12373 \u12356 \u12290 "\cf4 \strokec4  \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 sheet\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 getSheetByName\cf4 \strokec4 (\cf6 \strokec6 'Reservations'\cf4 \strokec4 ); \cb1 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (!\cf5 \strokec5 sheet\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf2 \strokec2 throw\cf4 \strokec4  \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf6 \strokec6 '\uc0\u12471 \u12540 \u12488 \u12300 Reservations\u12301 \u12364 \u35211 \u12388 \u12363 \u12426 \u12414 \u12379 \u12435 \u12391 \u12375 \u12383 \u12290 \u12471 \u12540 \u12488 \u21517 \u12434 \u30906 \u35469 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 '\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 data\cf4 \strokec4  = \cf5 \strokec5 sheet\cf4 \strokec4 .\cf5 \strokec5 getDataRange\cf4 \strokec4 ().\cf5 \strokec5 getValues\cf4 \strokec4 ();\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 reservationRowIndex\cf4 \strokec4  = -\cf9 \strokec9 1\cf4 \strokec4 ; \cb1 \
\
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 searchStudentIdUpper\cf4 \strokec4  = \cf5 \strokec5 studentId\cf4 \strokec4 .\cf5 \strokec5 toUpperCase\cf4 \strokec4 ();\cb1 \
\
\cb3     \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 i\cf4 \strokec4  = \cf9 \strokec9 1\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4  < \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 length\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 3\cf4 \strokec4 ].\cf5 \strokec5 toString\cf4 \strokec4 ().\cf5 \strokec5 toUpperCase\cf4 \strokec4 () === \cf5 \strokec5 searchStudentIdUpper\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf5 \strokec5 reservationRowIndex\cf4 \strokec4  = \cf5 \strokec5 i\cf4 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 break\cf4 \strokec4 ;\cb1 \
\cb3       \}\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 reservationRowIndex\cf4 \strokec4  === -\cf9 \strokec9 1\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u23398 \u31821 \u30058 \u21495  '\cf4 \strokec4  + \cf5 \strokec5 studentId\cf4 \strokec4  + \cf6 \strokec6 ' \uc0\u12398 \u20104 \u32004 \u12364 \u35211 \u12388 \u12363 \u12426 \u12414 \u12379 \u12435 \u12391 \u12375 \u12383 \u12290 '\cf4 \strokec4  \};\cb1 \
\cb3     \}\cb1 \
\cb3     \cb1 \
\cb3     \cf8 \strokec8 // \uc0\u30330 \u21048 \u28168 \u12415 \u12501 \u12521 \u12464 \u12434 \u31435 \u12390 \u12427 \cf4 \cb1 \strokec4 \
\cb3     \cf5 \strokec5 sheet\cf4 \strokec4 .\cf5 \strokec5 getRange\cf4 \strokec4 (\cf5 \strokec5 reservationRowIndex\cf4 \strokec4  + \cf9 \strokec9 1\cf4 \strokec4 , \cf9 \strokec9 8\cf4 \strokec4 ).\cf5 \strokec5 setValue\cf4 \strokec4 (\cf2 \strokec2 true\cf4 \strokec4 ); \cb1 \
\
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'success'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u30330 \u21048 \u28168 \u12415 \u12510 \u12540 \u12463 \u12364 \u23436 \u20102 \u12375 \u12414 \u12375 \u12383 \u12290 '\cf4 \strokec4  \};\cb1 \
\
\cb3   \} \cf2 \strokec2 catch\cf4 \strokec4  (\cf5 \strokec5 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf5 \strokec5 e\cf4 \strokec4 .\cf5 \strokec5 message\cf4 \strokec4  \};\cb1 \
\cb3   \} \cf2 \strokec2 finally\cf4 \strokec4  \{\cb1 \
\cb3     \cf5 \strokec5 lock\cf4 \strokec4 .\cf5 \strokec5 releaseLock\cf4 \strokec4 ();\cb1 \
\cb3   \}\cb1 \
\cb3 \}\cb1 \
\
\
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 generateTicketHtml\cf4 \strokec4 (\cf5 \strokec5 reservation\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 groupName\cf4 \strokec4  = \cf6 \strokec6 ''\cf4 \strokec4 ; \cb1 \
\cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 groupColor\cf4 \strokec4  = \cf6 \strokec6 ''\cf4 \strokec4 ; \cf8 \strokec8 // \uc0\u12464 \u12523 \u12540 \u12503 \u12398 \u33394 \u12434 \u20445 \u23384 \u12377 \u12427 \u22793 \u25968 \u12434 \u36861 \u21152 \cf4 \cb1 \strokec4 \
\
\cb3   \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 seats\cf4 \strokec4  && \cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 seats\cf4 \strokec4 .\cf5 \strokec5 length\cf4 \strokec4  > \cf9 \strokec9 0\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 firstSeat\cf4 \strokec4  = \cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 seats\cf4 \strokec4 [\cf9 \strokec9 0\cf4 \strokec4 ];\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 column\cf4 \strokec4  = \cf5 \strokec5 firstSeat\cf4 \strokec4 .\cf5 \strokec5 charAt\cf4 \strokec4 (\cf9 \strokec9 0\cf4 \strokec4 ).\cf5 \strokec5 toUpperCase\cf4 \strokec4 ();\cb1 \
\
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 group1Columns\cf4 \strokec4  = [\cf6 \strokec6 'D'\cf4 \strokec4 , \cf6 \strokec6 'E'\cf4 \strokec4 , \cf6 \strokec6 'F'\cf4 \strokec4 , \cf6 \strokec6 'G'\cf4 \strokec4 , \cf6 \strokec6 'H'\cf4 \strokec4 , \cf6 \strokec6 'I'\cf4 \strokec4 , \cf6 \strokec6 'J'\cf4 \strokec4 , \cf6 \strokec6 'K'\cf4 \strokec4 ];\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 group2Columns\cf4 \strokec4  = [\cf6 \strokec6 'L'\cf4 \strokec4 , \cf6 \strokec6 'M'\cf4 \strokec4 , \cf6 \strokec6 'N'\cf4 \strokec4 , \cf6 \strokec6 'O'\cf4 \strokec4 , \cf6 \strokec6 'P'\cf4 \strokec4 , \cf6 \strokec6 'Q'\cf4 \strokec4 , \cf6 \strokec6 'R'\cf4 \strokec4 ];\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 group3Columns\cf4 \strokec4  = [\cf6 \strokec6 'S'\cf4 \strokec4 , \cf6 \strokec6 'T'\cf4 \strokec4 , \cf6 \strokec6 'U'\cf4 \strokec4 , \cf6 \strokec6 'V'\cf4 \strokec4 , \cf6 \strokec6 'W'\cf4 \strokec4 , \cf6 \strokec6 'X'\cf4 \strokec4 , \cf6 \strokec6 'Y'\cf4 \strokec4 ];\cb1 \
\
\cb3     \cf8 \strokec8 // \uc0\u12464 \u12523 \u12540 \u12503 \u12434 \u21028 \u23450 \u12375 \u12289 \u23550 \u24540 \u12377 \u12427 \u21517 \u21069 \u12392 \u12459 \u12521 \u12540 \u12467 \u12540 \u12489 \u12434 \u35373 \u23450 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 group1Columns\cf4 \strokec4 .\cf5 \strokec5 indexOf\cf4 \strokec4 (\cf5 \strokec5 column\cf4 \strokec4 ) !== -\cf9 \strokec9 1\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf5 \strokec5 groupName\cf4 \strokec4  = \cf6 \strokec6 'GROUP 1'\cf4 \strokec4 ;\cb1 \
\cb3       \cf5 \strokec5 groupColor\cf4 \strokec4  = \cf6 \strokec6 '#dd4540'\cf4 \strokec4 ; \cf8 \strokec8 // GROUP 1 \uc0\u12398 \u33394 \cf4 \cb1 \strokec4 \
\cb3     \} \cf2 \strokec2 else\cf4 \strokec4  \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 group2Columns\cf4 \strokec4 .\cf5 \strokec5 indexOf\cf4 \strokec4 (\cf5 \strokec5 column\cf4 \strokec4 ) !== -\cf9 \strokec9 1\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf5 \strokec5 groupName\cf4 \strokec4  = \cf6 \strokec6 'GROUP 2'\cf4 \strokec4 ;\cb1 \
\cb3       \cf5 \strokec5 groupColor\cf4 \strokec4  = \cf6 \strokec6 '#2c7ef4'\cf4 \strokec4 ; \cf8 \strokec8 // GROUP 2 \uc0\u12398 \u33394 \cf4 \cb1 \strokec4 \
\cb3     \} \cf2 \strokec2 else\cf4 \strokec4  \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 group3Columns\cf4 \strokec4 .\cf5 \strokec5 indexOf\cf4 \strokec4 (\cf5 \strokec5 column\cf4 \strokec4 ) !== -\cf9 \strokec9 1\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf5 \strokec5 groupName\cf4 \strokec4  = \cf6 \strokec6 'GROUP 3'\cf4 \strokec4 ;\cb1 \
\cb3       \cf5 \strokec5 groupColor\cf4 \strokec4  = \cf6 \strokec6 '#7ed957'\cf4 \strokec4 ; \cf8 \strokec8 // GROUP 3 \uc0\u12398 \u33394 \cf4 \cb1 \strokec4 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 groupHtml\cf4 \strokec4  = \cf6 \strokec6 ''\cf4 \strokec4 ;\cb1 \
\cb3   \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 groupName\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf8 \strokec8 // style\uc0\u23646 \u24615 \u12434 \u36861 \u21152 \u12375 \u12390 \u12289 \u21205 \u30340 \u12395 \u33394 \u12434 \u25351 \u23450 \u12377 \u12427 \u12424 \u12358 \u12395 \u22793 \u26356 \cf4 \cb1 \strokec4 \
\cb3     \cf5 \strokec5 groupHtml\cf4 \strokec4  = \cf6 \strokec6 `<p class="group-info" style="color: \cf4 \strokec4 $\{\cf5 \strokec5 groupColor\cf4 \strokec4 \}\cf6 \strokec6 ; border-color: \cf4 \strokec4 $\{\cf5 \strokec5 groupColor\cf4 \strokec4 \}\cf6 \strokec6 ;">\cf4 \strokec4 $\{\cf5 \strokec5 groupName\cf4 \strokec4 \}\cf6 \strokec6 </p>`\cf4 \strokec4 ;\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 seatsFormatted\cf4 \strokec4  = \cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 seats\cf4 \strokec4 .\cf5 \strokec5 join\cf4 \strokec4 (\cf6 \strokec6 ', '\cf4 \strokec4 );\cb1 \
\cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 dateFormatted\cf4 \strokec4  = \cf7 \strokec7 Utilities\cf4 \strokec4 .\cf5 \strokec5 formatDate\cf4 \strokec4 (\cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 date\cf4 \strokec4 , \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 getSpreadsheetTimeZone\cf4 \strokec4 (), \cf6 \strokec6 'yyyy/MM/dd HH:mm'\cf4 \strokec4 );\cb1 \
\
\cb3   \cf2 \strokec2 return\cf4 \strokec4  \cf6 \strokec6 `\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6     <h3>FunFestival \uc0\u24231 \u24109 \u25351 \u23450 \u21048 </h3>\cf4 \cb1 \strokec4 \
\cf6 \cb3 \strokec6     \cf4 \strokec4 $\{\cf5 \strokec5 groupHtml\cf4 \strokec4 \}\cb1 \
\cf6 \cb3 \strokec6     <p><strong>\uc0\u23398 \u24180 :</strong> \cf4 \strokec4 $\{\cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 grade\cf4 \strokec4 \}\cf6 \strokec6 </p>\cf4 \cb1 \strokec4 \
\cf6 \cb3 \strokec6     <p><strong>\uc0\u12463 \u12521 \u12473 :</strong> \cf4 \strokec4 $\{\cf5 \strokec5 reservation\cf4 \strokec4 .\cf2 \strokec2 class\cf4 \strokec4 \}\cf6 \strokec6 </p>\cf4 \cb1 \strokec4 \
\cf6 \cb3 \strokec6     <p><strong>\uc0\u23398 \u31821 \u30058 \u21495 :</strong> \cf4 \strokec4 $\{\cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 id\cf4 \strokec4 \}\cf6 \strokec6 </p>\cf4 \cb1 \strokec4 \
\cf6 \cb3 \strokec6     <p><strong>\uc0\u20104 \u32004 \u20195 \u34920 \u32773 \u27663 \u21517 :</strong> \cf4 \strokec4 $\{\cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 name\cf4 \strokec4 \}\cf6 \strokec6 </p>\cf4 \cb1 \strokec4 \
\cf6 \cb3 \strokec6     <p><strong>\uc0\u20104 \u32004 \u20154 \u25968 :</strong> \cf4 \strokec4 $\{\cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 count\cf4 \strokec4 \}\cf6 \strokec6 \uc0\u21517 </p>\cf4 \cb1 \strokec4 \
\cf6 \cb3 \strokec6     <p class="seat-info"><strong>\uc0\u24231 \u24109 :</strong> \cf4 \strokec4 $\{\cf5 \strokec5 seatsFormatted\cf4 \strokec4 \}\cf6 \strokec6 </p>\cf4 \cb1 \strokec4 \
\cf6 \cb3 \strokec6     <p><strong>\uc0\u20104 \u32004 \u26085 \u26178 :</strong> \cf4 \strokec4 $\{\cf5 \strokec5 dateFormatted\cf4 \strokec4 \}\cf6 \strokec6 </p>\cf4 \cb1 \strokec4 \
\cf6 \cb3 \strokec6     <p class="note">\uc0\u8251 \u12371 \u12398 \u12481 \u12465 \u12483 \u12488 \u12399 \u12289 \u12362 \u19968 \u20154 \u27096 1\u22238 \u38480 \u12426 \u26377 \u21177 \u12391 \u12377 \u12290 </p>\cf4 \cb1 \strokec4 \
\cf6 \cb3 \strokec6   `\cf4 \strokec4 ;\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 generateTicketPdf\cf4 \strokec4 (\cf5 \strokec5 studentId\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf7 \strokec7 TEMPLATE_DOC_ID\cf4 \strokec4  = \cf6 \strokec6 \'91**********\'92\cf4 \strokec4 ; \cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf7 \strokec7 TARGET_FOLDER_ID\cf4 \strokec4  = \cf6 \strokec6 \'91*********\'92\cf4 \strokec4 ; \cb1 \
\
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 sheet\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 getSheetByName\cf4 \strokec4 (\cf6 \strokec6 'Reservations'\cf4 \strokec4 ); \cb1 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (!\cf5 \strokec5 sheet\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf2 \strokec2 throw\cf4 \strokec4  \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf6 \strokec6 '\uc0\u12471 \u12540 \u12488 \u12300 Reservations\u12301 \u12364 \u35211 \u12388 \u12363 \u12426 \u12414 \u12379 \u12435 \u12391 \u12375 \u12383 \u12290 \u12471 \u12540 \u12488 \u21517 \u12434 \u30906 \u35469 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 '\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 data\cf4 \strokec4  = \cf5 \strokec5 sheet\cf4 \strokec4 .\cf5 \strokec5 getDataRange\cf4 \strokec4 ().\cf5 \strokec5 getValues\cf4 \strokec4 ();\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 reservation\cf4 \strokec4  = \cf2 \strokec2 null\cf4 \strokec4 ;\cb1 \
\
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 searchStudentIdUpper\cf4 \strokec4  = \cf5 \strokec5 studentId\cf4 \strokec4 .\cf5 \strokec5 toUpperCase\cf4 \strokec4 ();\cb1 \
\
\cb3     \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 i\cf4 \strokec4  = \cf9 \strokec9 1\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4  < \cf5 \strokec5 data\cf4 \strokec4 .\cf5 \strokec5 length\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 3\cf4 \strokec4 ].\cf5 \strokec5 toString\cf4 \strokec4 ().\cf5 \strokec5 toUpperCase\cf4 \strokec4 () === \cf5 \strokec5 searchStudentIdUpper\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf5 \strokec5 reservation\cf4 \strokec4  = \{\cb1 \
\cb3           \cf5 \strokec5 date\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 0\cf4 \strokec4 ],\cb1 \
\cb3           \cf5 \strokec5 grade\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 1\cf4 \strokec4 ],\cb1 \
\cb3           \cf2 \strokec2 class\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 2\cf4 \strokec4 ],\cb1 \
\cb3           \cf5 \strokec5 id\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 3\cf4 \strokec4 ],\cb1 \
\cb3           \cf5 \strokec5 name\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 4\cf4 \strokec4 ],\cb1 \
\cb3           \cf5 \strokec5 count\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 5\cf4 \strokec4 ],\cb1 \
\cb3           \cf5 \strokec5 seats\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 6\cf4 \strokec4 ].\cf5 \strokec5 split\cf4 \strokec4 (\cf6 \strokec6 ','\cf4 \strokec4 ).\cf5 \strokec5 map\cf4 \strokec4 (\cf5 \strokec5 s\cf4 \strokec4  => \cf5 \strokec5 s\cf4 \strokec4 .\cf5 \strokec5 trim\cf4 \strokec4 ()),\cb1 \
\cb3           \cf5 \strokec5 isIssued\cf4 \strokec4 : \cf5 \strokec5 data\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 7\cf4 \strokec4 ]\cb1 \
\cb3         \};\cb1 \
\cb3         \cf2 \strokec2 break\cf4 \strokec4 ;\cb1 \
\cb3       \}\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (!\cf5 \strokec5 reservation\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf8 \strokec8 // PDF\uc0\u29983 \u25104 \u12364 \u22833 \u25943 \u12375 \u12390 \u12418 \u20104 \u32004 \u20966 \u29702 \u20840 \u20307 \u12434 \u27490 \u12417 \u12394 \u12356 \u12424 \u12358 \u12395 \u12289 \u12456 \u12521 \u12540 \u12434 \u12473 \u12525 \u12540 \u12377 \u12427 \u20195 \u12431 \u12426 \u12395 \u12525 \u12464 \u12434 \u20986 \u21147 \u12377 \u12427 \cf4 \cb1 \strokec4 \
\cb3       \cf5 \strokec5 console\cf4 \strokec4 .\cf5 \strokec5 error\cf4 \strokec4 (\cf6 \strokec6 'PDF\uc0\u29983 \u25104 \u29992 \u12398 \u20104 \u32004 \u24773 \u22577 \u12364 \u35211 \u12388 \u12363 \u12426 \u12414 \u12379 \u12435 \u12391 \u12375 \u12383 \u12290 \u23398 \u31821 \u30058 \u21495 : '\cf4 \strokec4  + \cf5 \strokec5 studentId\cf4 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 return\cf4 \strokec4 ; \cf8 \strokec8 // \uc0\u20966 \u29702 \u12434 \u20013 \u26029 \cf4 \cb1 \strokec4 \
\cb3     \}\cb1 \
\
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 dateFormatted\cf4 \strokec4  = \cf7 \strokec7 Utilities\cf4 \strokec4 .\cf5 \strokec5 formatDate\cf4 \strokec4 (\cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 date\cf4 \strokec4 , \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 getSpreadsheetTimeZone\cf4 \strokec4 (), \cf6 \strokec6 'yyyy/MM/dd HH:mm'\cf4 \strokec4 );\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 seatsFormatted\cf4 \strokec4  = \cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 seats\cf4 \strokec4 .\cf5 \strokec5 join\cf4 \strokec4 (\cf6 \strokec6 ', '\cf4 \strokec4 );\cb1 \
\
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 templateFile\cf4 \strokec4  = \cf7 \strokec7 DriveApp\cf4 \strokec4 .\cf5 \strokec5 getFileById\cf4 \strokec4 (\cf7 \strokec7 TEMPLATE_DOC_ID\cf4 \strokec4 );\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 newDocTitle\cf4 \strokec4  = \cf6 \strokec6 'FunFestival_Ticket_'\cf4 \strokec4  + \cf5 \strokec5 studentId\cf4 \strokec4  + \cf6 \strokec6 '_'\cf4 \strokec4  + \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Date\cf4 \strokec4 ().\cf5 \strokec5 getTime\cf4 \strokec4 (); \cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 newDocFile\cf4 \strokec4  = \cf5 \strokec5 templateFile\cf4 \strokec4 .\cf5 \strokec5 makeCopy\cf4 \strokec4 (\cf5 \strokec5 newDocTitle\cf4 \strokec4 );\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 newDoc\cf4 \strokec4  = \cf7 \strokec7 DocumentApp\cf4 \strokec4 .\cf5 \strokec5 openById\cf4 \strokec4 (\cf5 \strokec5 newDocFile\cf4 \strokec4 .\cf5 \strokec5 getId\cf4 \strokec4 ());\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 body\cf4 \strokec4  = \cf5 \strokec5 newDoc\cf4 \strokec4 .\cf5 \strokec5 getBody\cf4 \strokec4 ();\cb1 \
\
\cb3     \cf5 \strokec5 body\cf4 \strokec4 .\cf5 \strokec5 replaceText\cf4 \strokec4 (\cf6 \strokec6 '\{\{grade\}\}'\cf4 \strokec4 , \cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 grade\cf4 \strokec4 );\cb1 \
\cb3     \cf5 \strokec5 body\cf4 \strokec4 .\cf5 \strokec5 replaceText\cf4 \strokec4 (\cf6 \strokec6 '\{\{class\}\}'\cf4 \strokec4 , \cf5 \strokec5 reservation\cf4 \strokec4 .\cf2 \strokec2 class\cf4 \strokec4 );\cb1 \
\cb3     \cf5 \strokec5 body\cf4 \strokec4 .\cf5 \strokec5 replaceText\cf4 \strokec4 (\cf6 \strokec6 '\{\{id\}\}'\cf4 \strokec4 , \cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 id\cf4 \strokec4 );\cb1 \
\cb3     \cf5 \strokec5 body\cf4 \strokec4 .\cf5 \strokec5 replaceText\cf4 \strokec4 (\cf6 \strokec6 '\{\{name\}\}'\cf4 \strokec4 , \cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 name\cf4 \strokec4 );\cb1 \
\cb3     \cf5 \strokec5 body\cf4 \strokec4 .\cf5 \strokec5 replaceText\cf4 \strokec4 (\cf6 \strokec6 '\{\{count\}\}'\cf4 \strokec4 , \cf5 \strokec5 reservation\cf4 \strokec4 .\cf5 \strokec5 count\cf4 \strokec4 .\cf5 \strokec5 toString\cf4 \strokec4 ()); \cb1 \
\cb3     \cf5 \strokec5 body\cf4 \strokec4 .\cf5 \strokec5 replaceText\cf4 \strokec4 (\cf6 \strokec6 '\{\{seats\}\}'\cf4 \strokec4 , \cf5 \strokec5 seatsFormatted\cf4 \strokec4 );\cb1 \
\cb3     \cf5 \strokec5 body\cf4 \strokec4 .\cf5 \strokec5 replaceText\cf4 \strokec4 (\cf6 \strokec6 '\{\{date\}\}'\cf4 \strokec4 , \cf5 \strokec5 dateFormatted\cf4 \strokec4 );\cb1 \
\
\cb3     \cf5 \strokec5 newDoc\cf4 \strokec4 .\cf5 \strokec5 saveAndClose\cf4 \strokec4 (); \cb1 \
\
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 pdfBlob\cf4 \strokec4  = \cf5 \strokec5 newDocFile\cf4 \strokec4 .\cf5 \strokec5 getAs\cf4 \strokec4 (\cf7 \strokec7 MimeType\cf4 \strokec4 .\cf7 \strokec7 PDF\cf4 \strokec4 );\cb1 \
\cb3     \cf5 \strokec5 pdfBlob\cf4 \strokec4 .\cf5 \strokec5 setName\cf4 \strokec4 (\cf6 \strokec6 'FunFestival_Ticket_'\cf4 \strokec4  + \cf5 \strokec5 studentId\cf4 \strokec4  + \cf6 \strokec6 '.pdf'\cf4 \strokec4 );\cb1 \
\
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 targetFolder\cf4 \strokec4  = \cf7 \strokec7 DriveApp\cf4 \strokec4 .\cf5 \strokec5 getFolderById\cf4 \strokec4 (\cf7 \strokec7 TARGET_FOLDER_ID\cf4 \strokec4 ); \cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 file\cf4 \strokec4  = \cf5 \strokec5 targetFolder\cf4 \strokec4 .\cf5 \strokec5 createFile\cf4 \strokec4 (\cf5 \strokec5 pdfBlob\cf4 \strokec4 ); \cb1 \
\cb3     \cb1 \
\cb3     \cf5 \strokec5 newDocFile\cf4 \strokec4 .\cf5 \strokec5 setTrashed\cf4 \strokec4 (\cf2 \strokec2 true\cf4 \strokec4 ); \cb1 \
\
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \cf5 \strokec5 file\cf4 \strokec4 .\cf5 \strokec5 getId\cf4 \strokec4 (); \cb1 \
\cb3 \}\cb1 \
\
\
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 sendMailToUser\cf4 \strokec4 (\cf5 \strokec5 dataFromClient\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf7 \strokec7 Logger\cf4 \strokec4 .\cf5 \strokec5 log\cf4 \strokec4 (\cf6 \strokec6 "sendMailToUser\uc0\u12364 \u12463 \u12521 \u12452 \u12450 \u12531 \u12488 \u12363 \u12425 \u21628 \u12403 \u20986 \u12373 \u12428 \u12414 \u12375 \u12383 \u12364 \u12289 \u12371 \u12398 \u38306 \u25968 \u12399 \u29694 \u22312 \u20351 \u29992 \u12373 \u12428 \u12390 \u12356 \u12414 \u12379 \u12435 \u12290 "\cf4 \strokec4 );\cb1 \
\cb3   \cf7 \strokec7 Logger\cf4 \strokec4 .\cf5 \strokec5 log\cf4 \strokec4 (\cf7 \strokec7 JSON\cf4 \strokec4 .\cf5 \strokec5 stringify\cf4 \strokec4 (\cf5 \strokec5 dataFromClient\cf4 \strokec4 ));\cb1 \
\cb3 \}\cb1 \
\
\
\pard\pardeftab720\partightenfactor0
\cf10 \cb3 \strokec10 /**\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * \uc0\u20104 \u32004 \u12398 \u21463 \u20184 \u26399 \u38291 \u20013 \u12363 \u12393 \u12358 \u12363 \u12434 \u21028 \u23450 \u12377 \u12427 \u38306 \u25968 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * @returns \{object\} \uc0\u21463 \u20184 \u20013 \u12363 \u12393 \u12358 \u12363 \u12398 \u12473 \u12486 \u12540 \u12479 \u12473 \u12392 \u12513 \u12483 \u12475 \u12540 \u12472 \u12434 \u21547 \u12416 \u12458 \u12502 \u12472 \u12455 \u12463 \u12488 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 getDeadlineStatus\cf4 \strokec4 () \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf8 \strokec8 // \uc0\u9660 \u9660 \u9660  \u12371 \u12371 \u12395 \u38283 \u22987 \u26085 \u26178 \u12392 \u32066 \u20102 \u26085 \u26178 \u12434 \u35373 \u23450 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356  \u9660 \u9660 \u9660 \cf4 \cb1 \strokec4 \
\cb3   \cf8 \strokec8 // \uc0\u24418 \u24335 : 'YYYY-MM-DD HH:MM:SS' (\u24180 -\u26376 -\u26085  \u26178 :\u20998 :\u31186 )\cf4 \cb1 \strokec4 \
\cb3   \cf2 \strokec2 const\cf4 \strokec4  \cf7 \strokec7 START_DATETIME_STRING\cf4 \strokec4  = \cf6 \strokec6 '2025-10-22 16:00:00'\cf4 \strokec4 ; \cf8 \strokec8 // \uc0\u38283 \u22987 \u26085 \u26178 \cf4 \cb1 \strokec4 \
\cb3   \cf2 \strokec2 const\cf4 \strokec4  \cf7 \strokec7 DEADLINE_DATETIME_STRING\cf4 \strokec4  = \cf6 \strokec6 '2025-12-29 23:59:59'\cf4 \strokec4 ; \cf8 \strokec8 // \uc0\u32066 \u20102 \u26085 \u26178 \cf4 \cb1 \strokec4 \
\cb3   \cf8 \strokec8 // \uc0\u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \u9650 \cf4 \cb1 \strokec4 \
\
\cb3   \cf2 \strokec2 const\cf4 \strokec4  \cf5 \strokec5 start\cf4 \strokec4  = \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Date\cf4 \strokec4 (\cf7 \strokec7 START_DATETIME_STRING\cf4 \strokec4 );\cb1 \
\cb3   \cf2 \strokec2 const\cf4 \strokec4  \cf5 \strokec5 deadline\cf4 \strokec4  = \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Date\cf4 \strokec4 (\cf7 \strokec7 DEADLINE_DATETIME_STRING\cf4 \strokec4 );\cb1 \
\cb3   \cf2 \strokec2 const\cf4 \strokec4  \cf5 \strokec5 now\cf4 \strokec4  = \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Date\cf4 \strokec4 ();\cb1 \
\
\cb3   \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 now\cf4 \strokec4  < \cf5 \strokec5 start\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf8 \strokec8 // \uc0\u20104 \u32004 \u38283 \u22987 \u26178 \u21051 \u12424 \u12426 \u21069 \u12398 \u22580 \u21512 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cb1 \
\cb3       \cf5 \strokec5 isOpen\cf4 \strokec4 : \cf2 \strokec2 false\cf4 \strokec4 , \cb1 \
\cb3       \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u24231 \u24109 \u12398 \u20107 \u21069 \u20104 \u32004 \u12399 \u12414 \u12384 \u38283 \u22987 \u12373 \u12428 \u12390 \u12356 \u12414 \u12379 \u12435 \u12290 \\n\\n\u20104 \u32004 \u21463 \u20184 \u12399  '\cf4 \strokec4  + \cf7 \strokec7 START_DATETIME_STRING\cf4 \strokec4  + \cf6 \strokec6 ' \uc0\u12363 \u12425 \u12391 \u12377 \u12290 \\n\u12418 \u12358 \u12375 \u12400 \u12425 \u12367 \u12362 \u24453 \u12385 \u12367 \u12384 \u12373 \u12356 \u12290 \\n\u26178 \u38291 \u12395 \u12394 \u12426 \u12414 \u12375 \u12383 \u12425 \u12522 \u12525 \u12540 \u12489 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 '\cf4 \cb1 \strokec4 \
\cb3     \};\cb1 \
\cb3   \} \cf2 \strokec2 else\cf4 \strokec4  \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 now\cf4 \strokec4  > \cf5 \strokec5 deadline\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf8 \strokec8 // \uc0\u20104 \u32004 \u32066 \u20102 \u26178 \u21051 \u12434 \u36942 \u12366 \u12390 \u12356 \u12427 \u22580 \u21512 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cb1 \
\cb3       \cf5 \strokec5 isOpen\cf4 \strokec4 : \cf2 \strokec2 false\cf4 \strokec4 , \cb1 \
\cb3       \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u30003 \u12375 \u35379 \u12354 \u12426 \u12414 \u12379 \u12435 \u12364 \u12289 \u24231 \u24109 \u12398 \u20107 \u21069 \u20104 \u32004 \u21463 \u20184 \u12399 \u32066 \u20102 \u12356 \u12383 \u12375 \u12414 \u12375 \u12383 \u12290 \\n\\n\u27531 \u24109 \u21450 \u12403 2\u38542 \u24109 \u12398 \u20104 \u32004 \u12399 \\n10\u26376 30\u26085 \u12539 31\u26085 \u12288 8:30~20:00\u12398 \u38291 \u12289 \u35352 \u24565 \u31085 \u29983 \u24466 \u36939 \u21942 \u26412 \u37096 \u12391 \u25215 \u12387 \u12390 \u12362 \u12426 \u12414 \u12377 \u12290 \\n\u12393 \u12358 \u12382 \u12372 \u21033 \u29992 \u12367 \u12384 \u12373 \u12356 \u65281 \\n\u12394 \u12362 \u12289 \u20107 \u21069 \u20104 \u32004 \u25351 \u23450 \u21048 \u12398 \u30330 \u21048 \u26178 \u38291 \u12418 \u21516 \u12376 \u26178 \u38291 \u12391 \u12398 \u12415 \u25215 \u12426 \u12414 \u12377 \u12290 \\n\u30330 \u21048 \u12373 \u12428 \u12394 \u12363 \u12387 \u12383 \u25351 \u23450 \u21048 \u12395 \u12388 \u12356 \u12390 \u12399 \u28961 \u21177 \u12392 \u12394 \u12426 \u12414 \u12377 \u12398 \u12391 \u12372 \u27880 \u24847 \u12367 \u12384 \u12373 \u12356 '\cf4 \strokec4  \cb1 \
\cb3     \};\cb1 \
\cb3   \} \cf2 \strokec2 else\cf4 \strokec4  \{\cb1 \
\cb3     \cf8 \strokec8 // \uc0\u21463 \u20184 \u26399 \u38291 \u20013 \u12398 \u22580 \u21512 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cb1 \
\cb3       \cf5 \strokec5 isOpen\cf4 \strokec4 : \cf2 \strokec2 true\cf4 \strokec4 ,\cb1 \
\cb3       \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 ''\cf4 \cb1 \strokec4 \
\cb3     \};\cb1 \
\cb3   \}\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf8 \cb3 \strokec8 // \uc0\u9660 \u9660 \u9660  \u20197 \u19979 \u12398 3\u12388 \u12398 \u38306 \u25968 \u12434  Code.gs \u12398 \u19968 \u30058 \u19979 \u12395 \u36861 \u21152 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356  \u9660 \u9660 \u9660 \cf4 \cb1 \strokec4 \
\
\cf8 \cb3 \strokec8 // \uc0\u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 // \uc0\u9733  2\u38542 \u24109 \u37197 \u24067 \u12471 \u12473 \u12486 \u12512 \u29992 \u12398 \u38306 \u25968 \u32676  (\u12371 \u12371 \u12363 \u12425 )\cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 // \uc0\u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \cf4 \cb1 \strokec4 \
\
\cf8 \cb3 \strokec8 // 2\uc0\u38542 \u24109 \u12398 \u37197 \u24067 \u29366 \u27841 \u12471 \u12540 \u12488 \u21517 \u65288 \u25163 \u38918 1\u12391 \u20316 \u25104 \u12375 \u12383 \u12471 \u12540 \u12488 \u21517 \u65289 \cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 var\cf4 \strokec4  \cf7 \strokec7 SECOND_FLOOR_SHEET_NAME\cf4 \strokec4  = \cf6 \strokec6 'SecondFloor'\cf4 \strokec4 ;\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf10 \cb3 \strokec10 /**\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * 2\uc0\u38542 \u24109 \u37197 \u24067 \u23550 \u35937 \u12363 \u12393 \u12358 \u12363 \u12434 \u12481 \u12455 \u12483 \u12463 \u12377 \u12427 \u38306 \u25968 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * @param \{string\} studentId - \uc0\u12481 \u12455 \u12483 \u12463 \u12377 \u12427 \u23398 \u31821 \u30058 \u21495 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * @returns \{object\} \uc0\u12481 \u12455 \u12483 \u12463 \u32080 \u26524  \{ status, message, details \}\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 checkEligibilityForSecondFloor\cf4 \strokec4 (\cf5 \strokec5 studentId\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 lock\cf4 \strokec4  = \cf7 \strokec7 LockService\cf4 \strokec4 .\cf5 \strokec5 getScriptLock\cf4 \strokec4 ();\cb1 \
\cb3   \cf2 \strokec2 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf5 \strokec5 lock\cf4 \strokec4 .\cf5 \strokec5 waitLock\cf4 \strokec4 (\cf9 \strokec9 5000\cf4 \strokec4 ); \cb1 \
\cb3   \} \cf2 \strokec2 catch\cf4 \strokec4  (\cf5 \strokec5 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 "\uc0\u29694 \u22312 \u12289 \u20182 \u12398 \u20966 \u29702 \u20013 \u12391 \u12377 \u12290 \\n\u24656 \u12428 \u20837 \u12426 \u12414 \u12377 \u12364 \u12289 \u12418 \u12358 \u19968 \u24230 \u12362 \u35430 \u12375 \u12367 \u12384 \u12373 \u12356 \u12290 "\cf4 \strokec4  \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 searchStudentIdUpper\cf4 \strokec4  = \cf5 \strokec5 studentId\cf4 \strokec4 .\cf5 \strokec5 toUpperCase\cf4 \strokec4 ();\cb1 \
\cb3     \cb1 \
\cb3     \cf8 \strokec8 // 1. 1\uc0\u38542 \u24109 (Reservations)\u12398 \u20104 \u32004 \u29366 \u27841 \u12434 \u12481 \u12455 \u12483 \u12463 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 reservationSheet\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 getSheetByName\cf4 \strokec4 (\cf6 \strokec6 'Reservations'\cf4 \strokec4 ); \cb1 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (!\cf5 \strokec5 reservationSheet\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf2 \strokec2 throw\cf4 \strokec4  \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf6 \strokec6 '\uc0\u12471 \u12540 \u12488 \u12300 Reservations\u12301 \u12364 \u35211 \u12388 \u12363 \u12426 \u12414 \u12379 \u12435 \u12391 \u12375 \u12383 \u12290 '\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 reservationData\cf4 \strokec4  = \cf5 \strokec5 reservationSheet\cf4 \strokec4 .\cf5 \strokec5 getDataRange\cf4 \strokec4 ().\cf5 \strokec5 getValues\cf4 \strokec4 ();\cb1 \
\cb3     \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 i\cf4 \strokec4  = \cf9 \strokec9 1\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4  < \cf5 \strokec5 reservationData\cf4 \strokec4 .\cf5 \strokec5 length\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 reservationData\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 3\cf4 \strokec4 ].\cf5 \strokec5 toString\cf4 \strokec4 ().\cf5 \strokec5 toUpperCase\cf4 \strokec4 () === \cf5 \strokec5 searchStudentIdUpper\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf8 \strokec8 // 1\uc0\u38542 \u24109 \u12395 \u20104 \u32004 \u12364 \u12354 \u12387 \u12383 \cf4 \cb1 \strokec4 \
\cb3         \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 seats\cf4 \strokec4  = \cf5 \strokec5 reservationData\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 6\cf4 \strokec4 ];\cb1 \
\cb3         \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 isIssued\cf4 \strokec4  = \cf5 \strokec5 reservationData\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 7\cf4 \strokec4 ];\cb1 \
\cb3         \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 message\cf4 \strokec4  = \cf6 \strokec6 '\uc0\u12304 1\u38542 \u24109 \u12391 \u20104 \u32004 \u28168 \u12415 \u12391 \u12377 \u12305 \\n\u37197 \u24067 \u12399 \u12391 \u12365 \u12414 \u12379 \u12435 \u12290 '\cf4 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 isIssued\cf4 \strokec4  === \cf2 \strokec2 true\cf4 \strokec4  || \cf7 \strokec7 String\cf4 \strokec4 (\cf5 \strokec5 isIssued\cf4 \strokec4 ).\cf5 \strokec5 toUpperCase\cf4 \strokec4 () === \cf6 \strokec6 'TRUE'\cf4 \strokec4 ) \{\cb1 \
\cb3             \cf5 \strokec5 message\cf4 \strokec4  += \cf6 \strokec6 '\\n(\uc0\u12473 \u12486 \u12540 \u12479 \u12473 : \u30330 \u21048 \u28168 \u12415 )'\cf4 \strokec4 ;\cb1 \
\cb3         \} \cf2 \strokec2 else\cf4 \strokec4  \{\cb1 \
\cb3             \cf5 \strokec5 message\cf4 \strokec4  += \cf6 \strokec6 '\\n(\uc0\u12473 \u12486 \u12540 \u12479 \u12473 : \u26410 \u30330 \u21048 )'\cf4 \strokec4 ;\cb1 \
\cb3         \}\cb1 \
\cb3         \cf2 \strokec2 return\cf4 \strokec4  \{ \cb1 \
\cb3           \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'floor1_reserved'\cf4 \strokec4 , \cb1 \
\cb3           \cf5 \strokec5 message\cf4 \strokec4 : \cf5 \strokec5 message\cf4 \strokec4 ,\cb1 \
\cb3           \cf5 \strokec5 details\cf4 \strokec4 : \cf5 \strokec5 generateTicketHtml\cf4 \strokec4 (\cf5 \strokec5 mapReservationData\cf4 \strokec4 (\cf5 \strokec5 reservationData\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ])) \cf8 \strokec8 // \uc0\u26082 \u23384 \u12398 HTML\u29983 \u25104 \u38306 \u25968 \u12434 \u27969 \u29992 \u12375 \u12390 \u35443 \u32048 \u34920 \u31034 \cf4 \cb1 \strokec4 \
\cb3         \};\cb1 \
\cb3       \}\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf8 \strokec8 // 2. 2\uc0\u38542 \u24109 (SecondFloor)\u12398 \u37197 \u24067 \u29366 \u27841 \u12434 \u12481 \u12455 \u12483 \u12463 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 secondFloorSheet\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 getSheetByName\cf4 \strokec4 (\cf7 \strokec7 SECOND_FLOOR_SHEET_NAME\cf4 \strokec4 );\cb1 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (!\cf5 \strokec5 secondFloorSheet\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf8 \strokec8 // \uc0\u12471 \u12540 \u12488 \u12364 \u12414 \u12384 \u12394 \u12356 \u22580 \u21512 \u12399 \u12289 \u12371 \u12371 \u12391 \u20316 \u25104 \u12377 \u12427 \cf4 \cb1 \strokec4 \
\cb3       \cf5 \strokec5 secondFloorSheet\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 insertSheet\cf4 \strokec4 (\cf7 \strokec7 SECOND_FLOOR_SHEET_NAME\cf4 \strokec4 );\cb1 \
\cb3       \cf5 \strokec5 secondFloorSheet\cf4 \strokec4 .\cf5 \strokec5 appendRow\cf4 \strokec4 ([\cf6 \strokec6 '\uc0\u12479 \u12452 \u12512 \u12473 \u12479 \u12531 \u12503 '\cf4 \strokec4 , \cf6 \strokec6 '\uc0\u23398 \u31821 \u30058 \u21495 '\cf4 \strokec4 ]);\cb1 \
\cb3       \cf7 \strokec7 Logger\cf4 \strokec4 .\cf5 \strokec5 log\cf4 \strokec4 (\cf6 \strokec6 '\uc0\u12471 \u12540 \u12488 \u12300 '\cf4 \strokec4  + \cf7 \strokec7 SECOND_FLOOR_SHEET_NAME\cf4 \strokec4  + \cf6 \strokec6 '\uc0\u12301 \u12434 \u33258 \u21205 \u20316 \u25104 \u12375 \u12414 \u12375 \u12383 \u12290 '\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\cb3     \cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 secondFloorData\cf4 \strokec4  = \cf5 \strokec5 secondFloorSheet\cf4 \strokec4 .\cf5 \strokec5 getDataRange\cf4 \strokec4 ().\cf5 \strokec5 getValues\cf4 \strokec4 ();\cb1 \
\cb3     \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 j\cf4 \strokec4  = \cf9 \strokec9 1\cf4 \strokec4 ; \cf5 \strokec5 j\cf4 \strokec4  < \cf5 \strokec5 secondFloorData\cf4 \strokec4 .\cf5 \strokec5 length\cf4 \strokec4 ; \cf5 \strokec5 j\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 secondFloorData\cf4 \strokec4 [\cf5 \strokec5 j\cf4 \strokec4 ][\cf9 \strokec9 1\cf4 \strokec4 ] && \cf5 \strokec5 secondFloorData\cf4 \strokec4 [\cf5 \strokec5 j\cf4 \strokec4 ][\cf9 \strokec9 1\cf4 \strokec4 ].\cf5 \strokec5 toString\cf4 \strokec4 ().\cf5 \strokec5 toUpperCase\cf4 \strokec4 () === \cf5 \strokec5 searchStudentIdUpper\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf8 \strokec8 // 2\uc0\u38542 \u24109 \u12391 \u37197 \u24067 \u28168 \u12415 \u12384 \u12387 \u12383 \cf4 \cb1 \strokec4 \
\cb3         \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 distributedDate\cf4 \strokec4  = \cf7 \strokec7 Utilities\cf4 \strokec4 .\cf5 \strokec5 formatDate\cf4 \strokec4 (\cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Date\cf4 \strokec4 (\cf5 \strokec5 secondFloorData\cf4 \strokec4 [\cf5 \strokec5 j\cf4 \strokec4 ][\cf9 \strokec9 0\cf4 \strokec4 ]), \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 getSpreadsheetTimeZone\cf4 \strokec4 (), \cf6 \strokec6 'yyyy/MM/dd HH:mm'\cf4 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 return\cf4 \strokec4  \{ \cb1 \
\cb3           \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'floor2_issued'\cf4 \strokec4 , \cb1 \
\cb3           \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u12304 2\u38542 \u24109 \u12481 \u12465 \u12483 \u12488 \u12399 \u26082 \u12395 \u37197 \u24067 \u28168 \u12415 \u12391 \u12377 \u12305 \\n(\u37197 \u24067 \u26085 \u26178 : '\cf4 \strokec4  + \cf5 \strokec5 distributedDate\cf4 \strokec4  + \cf6 \strokec6 ')'\cf4 \strokec4 ,\cb1 \
\cb3           \cf5 \strokec5 details\cf4 \strokec4 : \cf6 \strokec6 '<p><strong>\uc0\u23398 \u31821 \u30058 \u21495 :</strong> '\cf4 \strokec4  + \cf5 \strokec5 studentId\cf4 \strokec4  + \cf6 \strokec6 '</p><p><strong>\uc0\u37197 \u24067 \u26085 \u26178 :</strong> '\cf4 \strokec4  + \cf5 \strokec5 distributedDate\cf4 \strokec4  + \cf6 \strokec6 '</p>'\cf4 \cb1 \strokec4 \
\cb3         \};\cb1 \
\cb3       \}\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf8 \strokec8 // 3. \uc0\u12393 \u12385 \u12425 \u12395 \u12418 \u35442 \u24403 \u12375 \u12394 \u12356 \u22580 \u21512  -> \u37197 \u24067 \u21487 \u33021 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cb1 \
\cb3       \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'eligible'\cf4 \strokec4 , \cb1 \
\cb3       \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u12304 \u37197 \u24067 \u21487 \u33021 \u12391 \u12377 \u12305 '\cf4 \strokec4 ,\cb1 \
\cb3       \cf5 \strokec5 details\cf4 \strokec4 : \cf6 \strokec6 '<p><strong>\uc0\u23398 \u31821 \u30058 \u21495 :</strong> '\cf4 \strokec4  + \cf5 \strokec5 studentId\cf4 \strokec4  + \cf6 \strokec6 '</p><p>\uc0\u12371 \u12398 \u29983 \u24466 \u12399 1\u38542 \u24109 \u12398 \u20104 \u32004 \u12364 \u12394 \u12367 \u12289 2\u38542 \u24109 \u12398 \u37197 \u24067 \u35352 \u37682 \u12418 \u12354 \u12426 \u12414 \u12379 \u12435 \u12290 </p>'\cf4 \cb1 \strokec4 \
\cb3     \};\cb1 \
\
\cb3   \} \cf2 \strokec2 catch\cf4 \strokec4  (\cf5 \strokec5 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u12456 \u12521 \u12540 \u12364 \u30330 \u29983 \u12375 \u12414 \u12375 \u12383 : '\cf4 \strokec4  + \cf5 \strokec5 e\cf4 \strokec4 .\cf5 \strokec5 message\cf4 \strokec4 , \cf5 \strokec5 details\cf4 \strokec4 : \cf6 \strokec6 ''\cf4 \strokec4  \};\cb1 \
\cb3   \} \cf2 \strokec2 finally\cf4 \strokec4  \{\cb1 \
\cb3     \cf5 \strokec5 lock\cf4 \strokec4 .\cf5 \strokec5 releaseLock\cf4 \strokec4 ();\cb1 \
\cb3   \}\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf10 \cb3 \strokec10 /**\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * 2\uc0\u38542 \u24109 \u12481 \u12465 \u12483 \u12488 \u12398 \u37197 \u24067 \u12434 \u35352 \u37682 \u12377 \u12427 \u38306 \u25968 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * @param \{string\} studentId - \uc0\u35352 \u37682 \u12377 \u12427 \u23398 \u31821 \u30058 \u21495 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * @returns \{object\} \uc0\u35352 \u37682 \u32080 \u26524  \{ status, message \}\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 recordSecondFloorDistribution\cf4 \strokec4 (\cf5 \strokec5 studentId\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 lock\cf4 \strokec4  = \cf7 \strokec7 LockService\cf4 \strokec4 .\cf5 \strokec5 getScriptLock\cf4 \strokec4 ();\cb1 \
\cb3   \cf2 \strokec2 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf5 \strokec5 lock\cf4 \strokec4 .\cf5 \strokec5 waitLock\cf4 \strokec4 (\cf9 \strokec9 5000\cf4 \strokec4 ); \cb1 \
\cb3   \} \cf2 \strokec2 catch\cf4 \strokec4  (\cf5 \strokec5 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 "\uc0\u29694 \u22312 \u12289 \u20182 \u12398 \u20966 \u29702 \u20013 \u12391 \u12377 \u12290 \\n\u24656 \u12428 \u20837 \u12426 \u12414 \u12377 \u12364 \u12289 \u12418 \u12358 \u19968 \u24230 \u12362 \u35430 \u12375 \u12367 \u12384 \u12373 \u12356 \u12290 "\cf4 \strokec4  \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 searchStudentIdUpper\cf4 \strokec4  = \cf5 \strokec5 studentId\cf4 \strokec4 .\cf5 \strokec5 toUpperCase\cf4 \strokec4 ();\cb1 \
\
\cb3     \cf8 \strokec8 // \uc0\u24565 \u12398 \u12383 \u12417 \u12289 \u20877 \u24230 \u12481 \u12455 \u12483 \u12463  (\u29305 \u12395 \u20108 \u37325 \u37197 \u24067 \u38450 \u27490 )\cf4 \cb1 \strokec4 \
\cb3     \cf8 \strokec8 // \uc0\u8251 checkEligibilityForSecondFloor\u12399 \u12525 \u12483 \u12463 \u12434 \u20869 \u37096 \u12391 \u12363 \u12369 \u12390 \u12356 \u12427 \u12398 \u12391 \u12289 \u12371 \u12371 \u12391 \u12399 \u12525 \u12483 \u12463 \u35299 \u38500 \u24460 \u12395 \u21628 \u12403 \u20986 \u12377 \cf4 \cb1 \strokec4 \
\cb3     \cf5 \strokec5 lock\cf4 \strokec4 .\cf5 \strokec5 releaseLock\cf4 \strokec4 (); \cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 eligibility\cf4 \strokec4  = \cf5 \strokec5 checkEligibilityForSecondFloor\cf4 \strokec4 (\cf5 \strokec5 studentId\cf4 \strokec4 );\cb1 \
\cb3     \cf5 \strokec5 lock\cf4 \strokec4 .\cf5 \strokec5 waitLock\cf4 \strokec4 (\cf9 \strokec9 5000\cf4 \strokec4 ); \cf8 \strokec8 // \uc0\u20877 \u24230 \u12525 \u12483 \u12463 \cf4 \cb1 \strokec4 \
\
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 eligibility\cf4 \strokec4 .\cf5 \strokec5 status\cf4 \strokec4  !== \cf6 \strokec6 'eligible'\cf4 \strokec4 ) \{\cb1 \
\cb3        \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u35352 \u37682 \u12456 \u12521 \u12540 : '\cf4 \strokec4  + \cf5 \strokec5 eligibility\cf4 \strokec4 .\cf5 \strokec5 message\cf4 \strokec4 .\cf5 \strokec5 replace\cf4 \strokec4 (\cf11 \strokec11 /\\n/\cf2 \strokec2 g\cf4 \strokec4 , \cf6 \strokec6 ' '\cf4 \strokec4 ) \}; \cf8 \strokec8 // \uc0\u12513 \u12483 \u12475 \u12540 \u12472 \u12434 1\u34892 \u12395 \cf4 \cb1 \strokec4 \
\cb3     \}\cb1 \
\
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 secondFloorSheet\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 getSheetByName\cf4 \strokec4 (\cf7 \strokec7 SECOND_FLOOR_SHEET_NAME\cf4 \strokec4 );\cb1 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (!\cf5 \strokec5 secondFloorSheet\cf4 \strokec4 ) \{\cb1 \
\cb3        \cf2 \strokec2 throw\cf4 \strokec4  \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf6 \strokec6 '\uc0\u12471 \u12540 \u12488 \u12300 '\cf4 \strokec4  + \cf7 \strokec7 SECOND_FLOOR_SHEET_NAME\cf4 \strokec4  + \cf6 \strokec6 '\uc0\u12301 \u12364 \u35211 \u12388 \u12363 \u12426 \u12414 \u12379 \u12435 \u12391 \u12375 \u12383 \u12290 '\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\cb3     \cb1 \
\cb3     \cf8 \strokec8 // \uc0\u12487 \u12540 \u12479 \u12434 \u36861 \u21152 \cf4 \cb1 \strokec4 \
\cb3     \cf5 \strokec5 secondFloorSheet\cf4 \strokec4 .\cf5 \strokec5 appendRow\cf4 \strokec4 ([\cb1 \
\cb3       \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Date\cf4 \strokec4 (),\cb1 \
\cb3       \cf5 \strokec5 studentId\cf4 \strokec4 .\cf5 \strokec5 trim\cf4 \strokec4 () \cf8 \strokec8 // \uc0\u23398 \u31821 \u30058 \u21495 \u12434 \u35352 \u37682 \cf4 \cb1 \strokec4 \
\cb3     ]);\cb1 \
\
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'success'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u37197 \u24067 \u12434 \u35352 \u37682 \u12375 \u12414 \u12375 \u12383 \u65281 \\n(\u23398 \u31821 \u30058 \u21495 : '\cf4 \strokec4  + \cf5 \strokec5 studentId\cf4 \strokec4  + \cf6 \strokec6 ')'\cf4 \strokec4  \};\cb1 \
\
\cb3   \} \cf2 \strokec2 catch\cf4 \strokec4  (\cf5 \strokec5 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u35352 \u37682 \u20013 \u12395 \u12456 \u12521 \u12540 \u12364 \u30330 \u29983 \u12375 \u12414 \u12375 \u12383 : '\cf4 \strokec4  + \cf5 \strokec5 e\cf4 \strokec4 .\cf5 \strokec5 message\cf4 \strokec4  \};\cb1 \
\cb3   \} \cf2 \strokec2 finally\cf4 \strokec4  \{\cb1 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 lock\cf4 \strokec4 .\cf5 \strokec5 hasLock\cf4 \strokec4 ()) \{ \cf8 \strokec8 // \uc0\u12414 \u12384 \u12525 \u12483 \u12463 \u12434 \u25345 \u12387 \u12390 \u12356 \u12383 \u12425 \u35299 \u38500 \cf4 \cb1 \strokec4 \
\cb3         \cf5 \strokec5 lock\cf4 \strokec4 .\cf5 \strokec5 releaseLock\cf4 \strokec4 ();\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf10 \cb3 \strokec10 /**\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * generateTicketHtml\uc0\u38306 \u25968 \u12395 \u28193 \u12377 \u12383 \u12417 \u12398 \u20104 \u32004 \u12487 \u12540 \u12479 \u12458 \u12502 \u12472 \u12455 \u12463 \u12488 \u12434 \u20316 \u25104 \u12377 \u12427 \u12504 \u12523 \u12497 \u12540 \u38306 \u25968 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * (checkEligibilityForSecondFloor\uc0\u20869 \u12391 \u12398 \u12415 \u20351 \u29992 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 mapReservationData\cf4 \strokec4 (\cf5 \strokec5 dataRow\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf2 \strokec2 return\cf4 \strokec4  \{\cb1 \
\cb3     \cf5 \strokec5 date\cf4 \strokec4 : \cf5 \strokec5 dataRow\cf4 \strokec4 [\cf9 \strokec9 0\cf4 \strokec4 ],\cb1 \
\cb3     \cf5 \strokec5 grade\cf4 \strokec4 : \cf5 \strokec5 dataRow\cf4 \strokec4 [\cf9 \strokec9 1\cf4 \strokec4 ],\cb1 \
\cb3     \cf2 \strokec2 class\cf4 \strokec4 : \cf5 \strokec5 dataRow\cf4 \strokec4 [\cf9 \strokec9 2\cf4 \strokec4 ],\cb1 \
\cb3     \cf5 \strokec5 id\cf4 \strokec4 : \cf5 \strokec5 dataRow\cf4 \strokec4 [\cf9 \strokec9 3\cf4 \strokec4 ],\cb1 \
\cb3     \cf5 \strokec5 name\cf4 \strokec4 : \cf5 \strokec5 dataRow\cf4 \strokec4 [\cf9 \strokec9 4\cf4 \strokec4 ],\cb1 \
\cb3     \cf5 \strokec5 count\cf4 \strokec4 : \cf5 \strokec5 dataRow\cf4 \strokec4 [\cf9 \strokec9 5\cf4 \strokec4 ],\cb1 \
\cb3     \cf5 \strokec5 seats\cf4 \strokec4 : \cf5 \strokec5 dataRow\cf4 \strokec4 [\cf9 \strokec9 6\cf4 \strokec4 ].\cf5 \strokec5 split\cf4 \strokec4 (\cf6 \strokec6 ','\cf4 \strokec4 ).\cf5 \strokec5 map\cf4 \strokec4 (\cf5 \strokec5 s\cf4 \strokec4  => \cf5 \strokec5 s\cf4 \strokec4 .\cf5 \strokec5 trim\cf4 \strokec4 ()),\cb1 \
\cb3     \cf5 \strokec5 isIssued\cf4 \strokec4 : \cf5 \strokec5 dataRow\cf4 \strokec4 [\cf9 \strokec9 7\cf4 \strokec4 ]\cb1 \
\cb3   \};\cb1 \
\cb3 \}\cb1 \
\
\
\pard\pardeftab720\partightenfactor0
\cf8 \cb3 \strokec8 // \uc0\u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 // \uc0\u9733  2\u38542 \u24109 \u37197 \u24067 \u12471 \u12473 \u12486 \u12512 \u29992 \u12398 \u38306 \u25968 \u32676  (\u12371 \u12371 \u12414 \u12391 )\cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 // \uc0\u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \cf4 \cb1 \strokec4 \
\
\cf8 \cb3 \strokec8 // \uc0\u9650 \u9650 \u9650  \u36861 \u21152 \u12371 \u12371 \u12414 \u12391  \u9650 \u9650 \u9650 \cf4 \cb1 \strokec4 \
\
\
\cf8 \cb3 \strokec8 // \uc0\u9660 \u9660 \u9660  \u20197 \u19979 \u12398 \u38306 \u25968 \u12434  Code.gs \u12398 \u19968 \u30058 \u19979 \u12395 \u36861 \u21152 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356  \u9660 \u9660 \u9660 \cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 // (\uc0\u12418 \u12375 \u21069 \u22238  assignSameDayTicket \u12394 \u12393 \u12434 \u36861 \u21152 \u12375 \u12390 \u12356 \u12383 \u12425 \u12289 \u12381 \u12428 \u12425 \u12399 \u21066 \u38500 \u12375 \u12390 \u12371 \u12428 \u12395 \u32622 \u12365 \u25563 \u12360 \u12390 \u12367 \u12384 \u12373 \u12356 )\cf4 \cb1 \strokec4 \
\
\cf8 \cb3 \strokec8 // \uc0\u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 // \uc0\u9733  1\u38542 \u24109  \u24403 \u26085 \u21048 \u12300 \u25163 \u21205 \u12301 \u21106 \u12426 \u24403 \u12390 \u38306 \u25968 \cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 // \uc0\u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\partightenfactor0
\cf10 \cb3 \strokec10 /**\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * 1\uc0\u38542 \u24109 \u12398 \u24403 \u26085 \u21048 \u12434 \u12300 \u25351 \u23450 \u12373 \u12428 \u12383 \u24109 \u12301 \u12395 \u21106 \u12426 \u24403 \u12390 \u12427 \u38306 \u25968 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * @param \{string\} studentId - \uc0\u23398 \u31821 \u30058 \u21495 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * @param \{string\} seatId - \uc0\u24231 \u24109 \u30058 \u21495  (\u20363 : 'F5', 'K10')\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * @returns \{object\} \{ status, message \}\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 assignSpecificSameDayTicket\cf4 \strokec4 (\cf5 \strokec5 studentId\cf4 \strokec4 , \cf5 \strokec5 seatId\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 lock\cf4 \strokec4  = \cf7 \strokec7 LockService\cf4 \strokec4 .\cf5 \strokec5 getScriptLock\cf4 \strokec4 ();\cb1 \
\cb3   \cf2 \strokec2 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf5 \strokec5 lock\cf4 \strokec4 .\cf5 \strokec5 waitLock\cf4 \strokec4 (\cf9 \strokec9 10000\cf4 \strokec4 ); \cb1 \
\cb3   \} \cf2 \strokec2 catch\cf4 \strokec4  (\cf5 \strokec5 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 "\uc0\u29694 \u22312 \u12289 \u20182 \u12398 \u20966 \u29702 \u20013 \u12391 \u12377 \u12290 \\n\u24656 \u12428 \u20837 \u12426 \u12414 \u12377 \u12364 \u12289 \u12418 \u12358 \u19968 \u24230 \u12362 \u35430 \u12375 \u12367 \u12384 \u12373 \u12356 \u12290 "\cf4 \strokec4  \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 searchStudentIdUpper\cf4 \strokec4  = \cf5 \strokec5 studentId\cf4 \strokec4 .\cf5 \strokec5 toUpperCase\cf4 \strokec4 ();\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 searchSeatIdUpper\cf4 \strokec4  = \cf5 \strokec5 seatId\cf4 \strokec4 .\cf5 \strokec5 toUpperCase\cf4 \strokec4 (); \cf8 \strokec8 // F5\cf4 \cb1 \strokec4 \
\
\cb3     \cf8 \strokec8 // 1. 1\uc0\u38542 \u24109 \u12539 2\u38542 \u24109 \u12395 \u26082 \u12395 \u30331 \u37682 \u12364 \u12394 \u12356 \u12363 \u12481 \u12455 \u12483 \u12463 \cf4 \cb1 \strokec4 \
\cb3     \cf8 \strokec8 // (checkStudentRegistrationStatus \uc0\u12399 \u12289 \u21069 \u22238 \u25552 \u26696 \u12375 \u12383 \u38306 \u25968 \u12290 \u12418 \u12375 \u21066 \u38500 \u12375 \u12383 \u22580 \u21512 \u12399 \u12289 \u12377 \u12368 \u19979 \u12395 \u23450 \u32681 \u12434 \u36028 \u12426 \u12414 \u12377 )\cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 check\cf4 \strokec4  = \cf5 \strokec5 checkStudentRegistrationStatus\cf4 \strokec4 (\cf5 \strokec5 searchStudentIdUpper\cf4 \strokec4 );\cb1 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (!\cf5 \strokec5 check\cf4 \strokec4 .\cf5 \strokec5 isEligible\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf5 \strokec5 check\cf4 \strokec4 .\cf5 \strokec5 message\cf4 \strokec4  \};\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf8 \strokec8 // 2. 1\uc0\u38542 \u24109 \u12398 \u31354 \u12365 \u29366 \u27841 \u12434 \u12481 \u12455 \u12483 \u12463 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 reservedData\cf4 \strokec4  = \cf5 \strokec5 getReservedSeats\cf4 \strokec4 (); \cf8 \strokec8 // \uc0\u26082 \u23384 \u12398 \u38306 \u25968 \u12434 \u27969 \u29992 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 reservedSeatsSet\cf4 \strokec4  = \{\}; \cb1 \
\cb3     \cf5 \strokec5 reservedData\cf4 \strokec4 .\cf5 \strokec5 reservedSeats\cf4 \strokec4 .\cf5 \strokec5 forEach\cf4 \strokec4 (\cf2 \strokec2 function\cf4 \strokec4 (\cf5 \strokec5 seat\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf5 \strokec5 reservedSeatsSet\cf4 \strokec4 [\cf5 \strokec5 seat\cf4 \strokec4 .\cf5 \strokec5 toUpperCase\cf4 \strokec4 ().\cf5 \strokec5 replace\cf4 \strokec4 (\cf6 \strokec6 '-'\cf4 \strokec4 , \cf6 \strokec6 ''\cf4 \strokec4 )] = \cf2 \strokec2 true\cf4 \strokec4 ; \cf8 \strokec8 // 'F-5' \uc0\u12418  'F5' \u12392 \u12375 \u12390 \u12475 \u12483 \u12488 \cf4 \cb1 \strokec4 \
\cb3     \});\cb1 \
\
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 reservedSeatsSet\cf4 \strokec4 [\cf5 \strokec5 searchSeatIdUpper\cf4 \strokec4 ]) \{\cb1 \
\cb3       \cf8 \strokec8 // \uc0\u21106 \u12426 \u24403 \u12390 \u12424 \u12358 \u12392 \u12375 \u12383 \u24109 \u12364 \u12289 \u26082 \u12395 \u20104 \u32004 \u28168 \u12415 \u12384 \u12387 \u12383 \cf4 \cb1 \strokec4 \
\cb3       \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u12304 \u12456 \u12521 \u12540 \u65306 \u20104 \u32004 \u28168 \u12415 \u12305 \\n\u24231 \u24109  '\cf4 \strokec4  + \cf5 \strokec5 seatId\cf4 \strokec4  + \cf6 \strokec6 ' \uc0\u12399 \u26082 \u12395 \u20104 \u32004 \u12373 \u12428 \u12390 \u12356 \u12414 \u12377 \u12290 \\n\u21029 \u12398 \u12481 \u12465 \u12483 \u12488 \u12434 \u30906 \u35469 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 '\cf4 \strokec4  \};\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf8 \strokec8 // 3. \uc0\u24109 \u12364 \u12510 \u12473 \u12479 \u12540 \u12522 \u12473 \u12488 \u12395 \u23384 \u22312 \u12377 \u12427 \u12363 \u12481 \u12455 \u12483 \u12463  (\u24565 \u12398 \u12383 \u12417 )\cf4 \cb1 \strokec4 \
\cb3     \cf8 \strokec8 // (generateFullSeatList \uc0\u12399 \u12289 \u21069 \u22238 \u25552 \u26696 \u12375 \u12383 \u38306 \u25968 \u12290 \u12418 \u12375 \u21066 \u38500 \u12375 \u12383 \u22580 \u21512 \u12399 \u12289 \u12377 \u12368 \u19979 \u12395 \u23450 \u32681 \u12434 \u36028 \u12426 \u12414 \u12377 )\cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 fullSeatList\cf4 \strokec4  = \cf5 \strokec5 generateFullSeatList\cf4 \strokec4 ();\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 fullSeatSet\cf4 \strokec4  = \{\};\cb1 \
\cb3     \cf5 \strokec5 fullSeatList\cf4 \strokec4 .\cf5 \strokec5 forEach\cf4 \strokec4 (\cf2 \strokec2 function\cf4 \strokec4 (\cf5 \strokec5 seat\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf5 \strokec5 fullSeatSet\cf4 \strokec4 [\cf5 \strokec5 seat\cf4 \strokec4 .\cf5 \strokec5 toUpperCase\cf4 \strokec4 ().\cf5 \strokec5 replace\cf4 \strokec4 (\cf6 \strokec6 '-'\cf4 \strokec4 , \cf6 \strokec6 ''\cf4 \strokec4 )] = \cf2 \strokec2 true\cf4 \strokec4 ;\cb1 \
\cb3     \});\cb1 \
\
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (!\cf5 \strokec5 fullSeatSet\cf4 \strokec4 [\cf5 \strokec5 searchSeatIdUpper\cf4 \strokec4 ]) \{\cb1 \
\cb3       \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u12304 \u12456 \u12521 \u12540 \u65306 \u28961 \u21177 \u12394 \u24109 \u12305 \\n\u24231 \u24109  '\cf4 \strokec4  + \cf5 \strokec5 seatId\cf4 \strokec4  + \cf6 \strokec6 ' \uc0\u12399 \u23384 \u22312 \u12375 \u12394 \u12356 \u24231 \u24109 \u30058 \u21495 \u12391 \u12377 \u12290 \\n\u20837 \u21147 \u12511 \u12473 \u12364 \u12394 \u12356 \u12363 \u30906 \u35469 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 '\cf4 \strokec4  \};\cb1 \
\cb3     \}\cb1 \
\
\
\cb3     \cf8 \strokec8 // 4. \uc0\u21839 \u38988 \u12394 \u12369 \u12428 \u12400 \u12289 DB\u12395 \u26360 \u12365 \u36796 \u12416 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 reservationSheet\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 getSheetByName\cf4 \strokec4 (\cf6 \strokec6 'Reservations'\cf4 \strokec4 );\cb1 \
\cb3     \cf5 \strokec5 reservationSheet\cf4 \strokec4 .\cf5 \strokec5 appendRow\cf4 \strokec4 ([\cb1 \
\cb3       \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Date\cf4 \strokec4 (),       \cf8 \strokec8 // \uc0\u12479 \u12452 \u12512 \u12473 \u12479 \u12531 \u12503 \cf4 \cb1 \strokec4 \
\cb3       \cf6 \strokec6 '\uc0\u24403 \u26085 '\cf4 \strokec4 ,           \cf8 \strokec8 // \uc0\u23398 \u24180 \cf4 \cb1 \strokec4 \
\cb3       \cf6 \strokec6 '\uc0\u24403 \u26085 '\cf4 \strokec4 ,           \cf8 \strokec8 // \uc0\u12463 \u12521 \u12473 \cf4 \cb1 \strokec4 \
\cb3       \cf5 \strokec5 studentId\cf4 \strokec4 .\cf5 \strokec5 trim\cf4 \strokec4 (), \cf8 \strokec8 // \uc0\u23398 \u31821 \u30058 \u21495 \cf4 \cb1 \strokec4 \
\cb3       \cf6 \strokec6 '\uc0\u24403 \u26085 \u21048 '\cf4 \strokec4 ,         \cf8 \strokec8 // \uc0\u21517 \u21069 \cf4 \cb1 \strokec4 \
\cb3       \cf9 \strokec9 1\cf4 \strokec4 ,                \cf8 \strokec8 // \uc0\u20154 \u25968 \cf4 \cb1 \strokec4 \
\cb3       \cf5 \strokec5 seatId\cf4 \strokec4 ,           \cf8 \strokec8 // \uc0\u24231 \u24109 \u30058 \u21495 \cf4 \cb1 \strokec4 \
\cb3       \cf2 \strokec2 true\cf4 \strokec4 ,             \cf8 \strokec8 // \uc0\u30330 \u21048 \u28168 \u12415 \u12501 \u12521 \u12464  (\u24403 \u26085 \u21048 \u12394 \u12398 \u12391 TRUE)\cf4 \cb1 \strokec4 \
\cb3       \cf2 \strokec2 false\cf4 \strokec4              \cf8 \strokec8 // PDF\uc0\u20316 \u25104 \u12501 \u12521 \u12464  (\u24403 \u26085 \u21048 \u12394 \u12398 \u12391 FALSE)\cf4 \cb1 \strokec4 \
\cb3     ]);\cb1 \
\cb3     \cb1 \
\cb3     \cf8 \strokec8 // 5. \uc0\u25104 \u21151 \u12434 \u36820 \u12377 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cb1 \
\cb3       \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'success'\cf4 \strokec4 , \cb1 \
\cb3       \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u12304 \u21106 \u12426 \u24403 \u12390 \u23436 \u20102 \u12305 \\n\u23398 \u31821 \u30058 \u21495 : '\cf4 \strokec4  + \cf5 \strokec5 studentId\cf4 \strokec4  + \cf6 \strokec6 '\\n\uc0\u24231 \u24109 : '\cf4 \strokec4  + \cf5 \strokec5 seatId\cf4 \strokec4  \cb1 \
\cb3     \};\cb1 \
\
\cb3   \} \cf2 \strokec2 catch\cf4 \strokec4  (\cf5 \strokec5 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u21106 \u12426 \u24403 \u12390 \u20013 \u12395 \u12456 \u12521 \u12540 \u12364 \u30330 \u29983 \u12375 \u12414 \u12375 \u12383 :\\n'\cf4 \strokec4  + \cf5 \strokec5 e\cf4 \strokec4 .\cf5 \strokec5 message\cf4 \strokec4  \};\cb1 \
\cb3   \} \cf2 \strokec2 finally\cf4 \strokec4  \{\cb1 \
\cb3     \cf5 \strokec5 lock\cf4 \strokec4 .\cf5 \strokec5 releaseLock\cf4 \strokec4 ();\cb1 \
\cb3   \}\cb1 \
\cb3 \}\cb1 \
\
\
\pard\pardeftab720\partightenfactor0
\cf8 \cb3 \strokec8 // --- \uc0\u20197 \u19979 \u12398 \u12504 \u12523 \u12497 \u12540 \u38306 \u25968 3\u12388 \u12364  `Code.gs` \u12395 \u23384 \u22312 \u12377 \u12427 \u12363 \u30906 \u35469 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356  ---\cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 // (\uc0\u12418 \u12375 \u21069 \u22238 \u36861 \u21152 \u12375 \u12394 \u12363 \u12387 \u12383 \u12426 \u12289 \u21066 \u38500 \u12375 \u12390 \u12375 \u12414 \u12387 \u12383 \u22580 \u21512 \u12399 \u12289 \u12371 \u12428 \u12425 \u12418 \u36861 \u21152 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 )\cf4 \cb1 \strokec4 \
\
\cf8 \cb3 \strokec8 // 2\uc0\u38542 \u24109 \u12398 \u37197 \u24067 \u29366 \u27841 \u12471 \u12540 \u12488 \u21517 \u65288 SecondFloorDist.html\u12398 \u26178 \u12395 \u23450 \u32681 \u65289 \cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 var\cf4 \strokec4  \cf7 \strokec7 SECOND_FLOOR_SHEET_NAME\cf4 \strokec4  = \cf6 \strokec6 'SecondFloor'\cf4 \strokec4 ; \cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf8 \cb3 \strokec8 // Index.html \uc0\u12363 \u12425 \u25345 \u12387 \u12390 \u12365 \u12383 \u24231 \u24109 \u12510 \u12473 \u12479 \u12540 \u12487 \u12540 \u12479 \cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 var\cf4 \strokec4  \cf7 \strokec7 SEAT_MASTER_MAP\cf4 \strokec4  = \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 'D'\cf4 \strokec4 : [\cf9 \strokec9 6\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'E'\cf4 \strokec4 : [\cf9 \strokec9 4\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'F'\cf4 \strokec4 : [\cf9 \strokec9 4\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ],\cb1 \
\cb3   \cf6 \strokec6 'G'\cf4 \strokec4 : [\cf9 \strokec9 3\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'H'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'I'\cf4 \strokec4 : [\cf9 \strokec9 1\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'J'\cf4 \strokec4 : [\cf9 \strokec9 1\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'K'\cf4 \strokec4 : [\cf9 \strokec9 1\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ],\cb1 \
\cb3   \cf6 \strokec6 'L'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'M'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'N'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'O'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'P'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ],\cb1 \
\cb3   \cf6 \strokec6 'Q'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'R'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'S'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'T'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'U'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ],\cb1 \
\cb3   \cf6 \strokec6 'V'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'W'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'X'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'Y'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ]\cb1 \
\cb3 \};\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf10 \cb3 \strokec10 /**\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * 1\uc0\u38542 \u24109 \u12398 \u20840 \u24231 \u24109 \u12522 \u12473 \u12488 \u12434 \u12510 \u12473 \u12479 \u12540 \u12487 \u12540 \u12479 \u12363 \u12425 \u29983 \u25104 \u12377 \u12427 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * @returns \{Array<string>\} ['D6', 'D7', ..., 'Y17']\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 generateFullSeatList\cf4 \strokec4 () \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 fullList\cf4 \strokec4  = [];\cb1 \
\cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 cols\cf4 \strokec4  = \cf7 \strokec7 Object\cf4 \strokec4 .\cf5 \strokec5 keys\cf4 \strokec4 (\cf7 \strokec7 SEAT_MASTER_MAP\cf4 \strokec4 );\cb1 \
\cb3   \cb1 \
\cb3   \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 i\cf4 \strokec4  = \cf9 \strokec9 0\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4  < \cf5 \strokec5 cols\cf4 \strokec4 .\cf5 \strokec5 length\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 col\cf4 \strokec4  = \cf5 \strokec5 cols\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ];\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 range\cf4 \strokec4  = \cf7 \strokec7 SEAT_MASTER_MAP\cf4 \strokec4 [\cf5 \strokec5 col\cf4 \strokec4 ];\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 start\cf4 \strokec4  = \cf5 \strokec5 range\cf4 \strokec4 [\cf9 \strokec9 0\cf4 \strokec4 ];\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 end\cf4 \strokec4  = \cf5 \strokec5 range\cf4 \strokec4 [\cf9 \strokec9 1\cf4 \strokec4 ];\cb1 \
\cb3     \cb1 \
\cb3     \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 row\cf4 \strokec4  = \cf5 \strokec5 start\cf4 \strokec4 ; \cf5 \strokec5 row\cf4 \strokec4  <= \cf5 \strokec5 end\cf4 \strokec4 ; \cf5 \strokec5 row\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf5 \strokec5 fullList\cf4 \strokec4 .\cf5 \strokec5 push\cf4 \strokec4 (\cf5 \strokec5 col\cf4 \strokec4  + \cf5 \strokec5 row\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\cb3   \cf2 \strokec2 return\cf4 \strokec4  \cf5 \strokec5 fullList\cf4 \strokec4 ;\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf10 \cb3 \strokec10 /**\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * [\uc0\u24403 \u26085 \u21048 \u29992 ] 1\u38542 \u24109 (Reservations)\u12392 2\u38542 \u24109 (SecondFloor)\u12398 \u20001 \u26041 \u12434 \u12481 \u12455 \u12483 \u12463 \u12377 \u12427 \u38306 \u25968 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * @param \{string\} studentIdUpper - \uc0\u22823 \u25991 \u23383 \u12395 \u22793 \u25563 \u28168 \u12415 \u12398 \u23398 \u31821 \u30058 \u21495 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * @returns \{object\} \{ isEligible: boolean, message: string \}\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 checkStudentRegistrationStatus\cf4 \strokec4 (\cf5 \strokec5 studentIdUpper\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf8 \strokec8 // 1. 1\uc0\u38542 \u24109 (Reservations)\u12398 \u12481 \u12455 \u12483 \u12463 \cf4 \cb1 \strokec4 \
\cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 reservationSheet\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 getSheetByName\cf4 \strokec4 (\cf6 \strokec6 'Reservations'\cf4 \strokec4 ); \cb1 \
\cb3   \cf2 \strokec2 if\cf4 \strokec4  (!\cf5 \strokec5 reservationSheet\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf2 \strokec2 throw\cf4 \strokec4  \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf6 \strokec6 '\uc0\u12471 \u12540 \u12488 \u12300 Reservations\u12301 \u12364 \u35211 \u12388 \u12363 \u12426 \u12414 \u12379 \u12435 \u12391 \u12375 \u12383 \u12290 '\cf4 \strokec4 );\cb1 \
\cb3   \}\cb1 \
\cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 reservationData\cf4 \strokec4  = \cf5 \strokec5 reservationSheet\cf4 \strokec4 .\cf5 \strokec5 getDataRange\cf4 \strokec4 ().\cf5 \strokec5 getValues\cf4 \strokec4 ();\cb1 \
\cb3   \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 i\cf4 \strokec4  = \cf9 \strokec9 1\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4  < \cf5 \strokec5 reservationData\cf4 \strokec4 .\cf5 \strokec5 length\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 reservationData\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 3\cf4 \strokec4 ].\cf5 \strokec5 toString\cf4 \strokec4 ().\cf5 \strokec5 toUpperCase\cf4 \strokec4 () === \cf5 \strokec5 studentIdUpper\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf2 \strokec2 return\cf4 \strokec4  \{ \cb1 \
\cb3         \cf5 \strokec5 isEligible\cf4 \strokec4 : \cf2 \strokec2 false\cf4 \strokec4 , \cb1 \
\cb3         \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u12304 1\u38542 \u24109 \u12391 \u20104 \u32004 \u28168 \u12415 \u12391 \u12377 \u12305 \\n(\u24231 \u24109 : '\cf4 \strokec4  + \cf5 \strokec5 reservationData\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ][\cf9 \strokec9 6\cf4 \strokec4 ] + \cf6 \strokec6 ')\\n\uc0\u24403 \u26085 \u21048 \u12398 \u21106 \u12426 \u24403 \u12390 \u12399 \u12391 \u12365 \u12414 \u12379 \u12435 \u12290 '\cf4 \strokec4  \cb1 \
\cb3       \};\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf8 \strokec8 // 2. 2\uc0\u38542 \u24109 (SecondFloor)\u12398 \u12481 \u12455 \u12483 \u12463 \cf4 \cb1 \strokec4 \
\cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 secondFloorSheet\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 getSheetByName\cf4 \strokec4 (\cf7 \strokec7 SECOND_FLOOR_SHEET_NAME\cf4 \strokec4 );\cb1 \
\cb3   \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 secondFloorSheet\cf4 \strokec4 ) \{ \cf8 \strokec8 // \uc0\u12471 \u12540 \u12488 \u12364 \u23384 \u22312 \u12377 \u12427 \u22580 \u21512 \u12398 \u12415 \u12481 \u12455 \u12483 \u12463 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 secondFloorData\cf4 \strokec4  = \cf5 \strokec5 secondFloorSheet\cf4 \strokec4 .\cf5 \strokec5 getDataRange\cf4 \strokec4 ().\cf5 \strokec5 getValues\cf4 \strokec4 ();\cb1 \
\cb3     \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 j\cf4 \strokec4  = \cf9 \strokec9 1\cf4 \strokec4 ; \cf5 \strokec5 j\cf4 \strokec4  < \cf5 \strokec5 secondFloorData\cf4 \strokec4 .\cf5 \strokec5 length\cf4 \strokec4 ; \cf5 \strokec5 j\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 secondFloorData\cf4 \strokec4 [\cf5 \strokec5 j\cf4 \strokec4 ][\cf9 \strokec9 1\cf4 \strokec4 ] && \cf5 \strokec5 secondFloorData\cf4 \strokec4 [\cf5 \strokec5 j\cf4 \strokec4 ][\cf9 \strokec9 1\cf4 \strokec4 ].\cf5 \strokec5 toString\cf4 \strokec4 ().\cf5 \strokec5 toUpperCase\cf4 \strokec4 () === \cf5 \strokec5 studentIdUpper\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf2 \strokec2 return\cf4 \strokec4  \{ \cb1 \
\cb3           \cf5 \strokec5 isEligible\cf4 \strokec4 : \cf2 \strokec2 false\cf4 \strokec4 , \cb1 \
\cb3           \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u12304 2\u38542 \u24109 \u12391 \u37197 \u24067 \u28168 \u12415 \u12391 \u12377 \u12305 \\n(\u37197 \u24067 \u26085 \u26178 : '\cf4 \strokec4  + \cf7 \strokec7 Utilities\cf4 \strokec4 .\cf5 \strokec5 formatDate\cf4 \strokec4 (\cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Date\cf4 \strokec4 (\cf5 \strokec5 secondFloorData\cf4 \strokec4 [\cf5 \strokec5 j\cf4 \strokec4 ][\cf9 \strokec9 0\cf4 \strokec4 ]), \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf5 \strokec5 getActiveSpreadsheet\cf4 \strokec4 ().\cf5 \strokec5 getSpreadsheetTimeZone\cf4 \strokec4 (), \cf6 \strokec6 'MM/dd HH:mm'\cf4 \strokec4 ) + \cf6 \strokec6 ')\\n\uc0\u24403 \u26085 \u21048 \u12398 \u21106 \u12426 \u24403 \u12390 \u12399 \u12391 \u12365 \u12414 \u12379 \u12435 \u12290 '\cf4 \cb1 \strokec4 \
\cb3         \};\cb1 \
\cb3       \}\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\cb3   \cb1 \
\cb3   \cf8 \strokec8 // \uc0\u12393 \u12385 \u12425 \u12395 \u12418 \u30331 \u37682 \u12364 \u12394 \u12369 \u12428 \u12400 \u23550 \u35937 \cf4 \cb1 \strokec4 \
\cb3   \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 isEligible\cf4 \strokec4 : \cf2 \strokec2 true\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 ''\cf4 \strokec4  \};\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf8 \cb3 \strokec8 // \uc0\u9660 \u9660 \u9660  \u20197 \u19979 \u12398 \u38306 \u25968 \u12434  Code.gs \u12398 \u19968 \u30058 \u19979 \u12395 \u36861 \u21152 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356  \u9660 \u9660 \u9660 \cf4 \cb1 \strokec4 \
\
\cf8 \cb3 \strokec8 // \uc0\u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 // \uc0\u9733  1\u38542 \u24109  \u31354 \u24109 \u12481 \u12465 \u12483 \u12488 HTML\u12522 \u12473 \u12488 \u29983 \u25104 \u29992 \cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 // \uc0\u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \u9733 \cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\partightenfactor0
\cf10 \cb3 \strokec10 /**\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * 1\uc0\u38542 \u24109 \u12398 \u31354 \u24109 \u12522 \u12473 \u12488 \u12434 \u21462 \u24471 \u12375 \u12289 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  * \uc0\u12381 \u12428 \u12382 \u12428 \u12434  'generateTicketHtml' \u12391 HTML\u12395 \u22793 \u25563 \u12375 \u12383 \u12522 \u12473 \u12488 \u12434 \u36820 \u12377 \cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 getAvailableTicketHtmlList\cf4 \strokec4 () \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf2 \strokec2 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf8 \strokec8 // 1. \uc0\u31354 \u24109 \u12522 \u12473 \u12488 \u12434 \u21462 \u24471  (\u21069 \u22238 \u20316 \u25104 \u12375 \u12383 \u38306 \u25968 )\cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 seatData\cf4 \strokec4  = \cf5 \strokec5 getAvailableFirstFloorSeats\cf4 \strokec4 ();\cb1 \
\cb3     \cf2 \strokec2 if\cf4 \strokec4  (\cf5 \strokec5 seatData\cf4 \strokec4 .\cf5 \strokec5 status\cf4 \strokec4  !== \cf6 \strokec6 'success'\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf2 \strokec2 throw\cf4 \strokec4  \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf6 \strokec6 '\uc0\u31354 \u24109 \u12522 \u12473 \u12488 \u12398 \u21462 \u24471 \u12395 \u22833 \u25943 \u12375 \u12414 \u12375 \u12383 \u12290 '\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\cb3     \cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 availableSeats\cf4 \strokec4  = \cf5 \strokec5 seatData\cf4 \strokec4 .\cf5 \strokec5 availableSeats\cf4 \strokec4 ;\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 ticketHtmls\cf4 \strokec4  = [];\cb1 \
\
\cb3     \cf8 \strokec8 // 2. \uc0\u31354 \u24109 \u12402 \u12392 \u12388 \u12402 \u12392 \u12388 \u12434 HTML\u12395 \u22793 \u25563 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 i\cf4 \strokec4  = \cf9 \strokec9 0\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4  < \cf5 \strokec5 availableSeats\cf4 \strokec4 .\cf5 \strokec5 length\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 seatId\cf4 \strokec4  = \cf5 \strokec5 availableSeats\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ];\cb1 \
\cb3       \cb1 \
\cb3       \cf8 \strokec8 // 3. 'generateTicketHtml' \uc0\u12395 \u28193 \u12377 \u12383 \u12417 \u12398 \u12300 \u24403 \u26085 \u21048 \u29992 \u12301 \u12480 \u12511 \u12540 \u12487 \u12540 \u12479 \u12434 \u20316 \u25104 \cf4 \cb1 \strokec4 \
\cb3       \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 placeholderReservation\cf4 \strokec4  = \{\cb1 \
\cb3         \cf5 \strokec5 date\cf4 \strokec4 : \cf2 \strokec2 new\cf4 \strokec4  \cf7 \strokec7 Date\cf4 \strokec4 (),       \cf8 \strokec8 // \uc0\u26085 \u20184 \u65288 \u12411 \u12412 \u12480 \u12511 \u12540 \u65289 \cf4 \cb1 \strokec4 \
\cb3         \cf5 \strokec5 grade\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u24403 \u26085 '\cf4 \strokec4 ,          \cf8 \strokec8 // \uc0\u23398 \u24180 \cf4 \cb1 \strokec4 \
\cb3         \cf2 \strokec2 class\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u24403 \u26085 '\cf4 \strokec4 ,          \cf8 \strokec8 // \uc0\u12463 \u12521 \u12473 \cf4 \cb1 \strokec4 \
\cb3         \cf5 \strokec5 id\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u24403 \u26085 \u21048 '\cf4 \strokec4 ,           \cf8 \strokec8 // \uc0\u23398 \u31821 \u30058 \u21495 \cf4 \cb1 \strokec4 \
\cb3         \cf5 \strokec5 name\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u24403 \u26085 \u21048  (1\u38542 \u24109 )'\cf4 \strokec4 , \cf8 \strokec8 // \uc0\u21517 \u21069 \cf4 \cb1 \strokec4 \
\cb3         \cf5 \strokec5 count\cf4 \strokec4 : \cf9 \strokec9 1\cf4 \strokec4 ,               \cf8 \strokec8 // \uc0\u20154 \u25968 \cf4 \cb1 \strokec4 \
\cb3         \cf5 \strokec5 seats\cf4 \strokec4 : [\cf5 \strokec5 seatId\cf4 \strokec4 ],        \cf8 \strokec8 // \uc0\u9733 \u12371 \u12371 \u12364 \u37325 \u35201 \u9733 \cf4 \cb1 \strokec4 \
\cb3         \cf5 \strokec5 isIssued\cf4 \strokec4 : \cf2 \strokec2 true\cf4 \cb1 \strokec4 \
\cb3       \};\cb1 \
\cb3       \cb1 \
\cb3       \cf8 \strokec8 // 4. TicketPrinter \uc0\u12392 \u21516 \u12376 HTML\u12434 \u29983 \u25104  (\u26082 \u23384 \u12398 \u38306 \u25968 \u12434 \u27969 \u29992 )\cf4 \cb1 \strokec4 \
\cb3       \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 html\cf4 \strokec4  = \cf5 \strokec5 generateTicketHtml\cf4 \strokec4 (\cf5 \strokec5 placeholderReservation\cf4 \strokec4 );\cb1 \
\cb3       \cf5 \strokec5 ticketHtmls\cf4 \strokec4 .\cf5 \strokec5 push\cf4 \strokec4 (\cf5 \strokec5 html\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\cb3     \cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'success'\cf4 \strokec4 , \cf5 \strokec5 ticketHtmls\cf4 \strokec4 : \cf5 \strokec5 ticketHtmls\cf4 \strokec4  \};\cb1 \
\cb3     \cb1 \
\cb3   \} \cf2 \strokec2 catch\cf4 \strokec4  (\cf5 \strokec5 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf7 \strokec7 Logger\cf4 \strokec4 .\cf5 \strokec5 log\cf4 \strokec4 (\cf6 \strokec6 'getAvailableTicketHtmlList Error: '\cf4 \strokec4  + \cf5 \strokec5 e\cf4 \strokec4 .\cf5 \strokec5 message\cf4 \strokec4 );\cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 'HTML\uc0\u12481 \u12465 \u12483 \u12488 \u12398 \u29983 \u25104 \u20013 \u12395 \u12456 \u12521 \u12540 \u12364 \u30330 \u29983 \u12375 \u12414 \u12375 \u12383 : '\cf4 \strokec4  + \cf5 \strokec5 e\cf4 \strokec4 .\cf5 \strokec5 message\cf4 \strokec4  \};\cb1 \
\cb3   \}\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf8 \cb3 \strokec8 // 1. 1\uc0\u38542 \u24109 \u12398 \u20840 \u24231 \u24109 \u12398 \u23450 \u32681  (Index.html \u12363 \u12425 )\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 var\cf4 \strokec4  \cf7 \strokec7 SEAT_MASTER_MAP\cf4 \strokec4  = \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 'D'\cf4 \strokec4 : [\cf9 \strokec9 6\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'E'\cf4 \strokec4 : [\cf9 \strokec9 4\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'F'\cf4 \strokec4 : [\cf9 \strokec9 4\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ],\cb1 \
\cb3   \cf6 \strokec6 'G'\cf4 \strokec4 : [\cf9 \strokec9 3\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'H'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'I'\cf4 \strokec4 : [\cf9 \strokec9 1\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'J'\cf4 \strokec4 : [\cf9 \strokec9 1\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'K'\cf4 \strokec4 : [\cf9 \strokec9 1\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ],\cb1 \
\cb3   \cf6 \strokec6 'L'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'M'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'N'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'O'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'P'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ],\cb1 \
\cb3   \cf6 \strokec6 'Q'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'R'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'S'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'T'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'U'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ],\cb1 \
\cb3   \cf6 \strokec6 'V'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'W'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'X'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ], \cf6 \strokec6 'Y'\cf4 \strokec4 : [\cf9 \strokec9 2\cf4 \strokec4 , \cf9 \strokec9 17\cf4 \strokec4 ]\cb1 \
\cb3 \};\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf8 \cb3 \strokec8 // 2. 1\uc0\u38542 \u24109 \u12398 \u20840 \u24231 \u24109 \u12522 \u12473 \u12488 \u12434 \u29983 \u25104 \u12377 \u12427 \u38306 \u25968 \cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 // (getAvailableFirstFloorSeats \uc0\u12364 \u12371 \u12428 \u12434 \u20351 \u12356 \u12414 \u12377 )\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 generateFullSeatList\cf4 \strokec4 () \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 fullList\cf4 \strokec4  = [];\cb1 \
\cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 cols\cf4 \strokec4  = \cf7 \strokec7 Object\cf4 \strokec4 .\cf5 \strokec5 keys\cf4 \strokec4 (\cf7 \strokec7 SEAT_MASTER_MAP\cf4 \strokec4 );\cb1 \
\cb3   \cb1 \
\cb3   \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 i\cf4 \strokec4  = \cf9 \strokec9 0\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4  < \cf5 \strokec5 cols\cf4 \strokec4 .\cf5 \strokec5 length\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 col\cf4 \strokec4  = \cf5 \strokec5 cols\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ];\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 range\cf4 \strokec4  = \cf7 \strokec7 SEAT_MASTER_MAP\cf4 \strokec4 [\cf5 \strokec5 col\cf4 \strokec4 ];\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 start\cf4 \strokec4  = \cf5 \strokec5 range\cf4 \strokec4 [\cf9 \strokec9 0\cf4 \strokec4 ];\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 end\cf4 \strokec4  = \cf5 \strokec5 range\cf4 \strokec4 [\cf9 \strokec9 1\cf4 \strokec4 ];\cb1 \
\cb3     \cb1 \
\cb3     \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 row\cf4 \strokec4  = \cf5 \strokec5 start\cf4 \strokec4 ; \cf5 \strokec5 row\cf4 \strokec4  <= \cf5 \strokec5 end\cf4 \strokec4 ; \cf5 \strokec5 row\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf5 \strokec5 fullList\cf4 \strokec4 .\cf5 \strokec5 push\cf4 \strokec4 (\cf5 \strokec5 col\cf4 \strokec4  + \cf5 \strokec5 row\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\cb3   \cf2 \strokec2 return\cf4 \strokec4  \cf5 \strokec5 fullList\cf4 \strokec4 ;\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf8 \cb3 \strokec8 // 2. 1\uc0\u38542 \u24109 \u12398 \u20840 \u24231 \u24109 \u12522 \u12473 \u12488 \u12434 \u29983 \u25104 \u12377 \u12427 \u38306 \u25968 \cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 // (getAvailableFirstFloorSeats \uc0\u12364 \u12371 \u12428 \u12434 \u20351 \u12356 \u12414 \u12377 )\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 generateFullSeatList\cf4 \strokec4 () \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 fullList\cf4 \strokec4  = [];\cb1 \
\cb3   \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 cols\cf4 \strokec4  = \cf7 \strokec7 Object\cf4 \strokec4 .\cf5 \strokec5 keys\cf4 \strokec4 (\cf7 \strokec7 SEAT_MASTER_MAP\cf4 \strokec4 );\cb1 \
\cb3   \cb1 \
\cb3   \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 i\cf4 \strokec4  = \cf9 \strokec9 0\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4  < \cf5 \strokec5 cols\cf4 \strokec4 .\cf5 \strokec5 length\cf4 \strokec4 ; \cf5 \strokec5 i\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 col\cf4 \strokec4  = \cf5 \strokec5 cols\cf4 \strokec4 [\cf5 \strokec5 i\cf4 \strokec4 ];\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 range\cf4 \strokec4  = \cf7 \strokec7 SEAT_MASTER_MAP\cf4 \strokec4 [\cf5 \strokec5 col\cf4 \strokec4 ];\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 start\cf4 \strokec4  = \cf5 \strokec5 range\cf4 \strokec4 [\cf9 \strokec9 0\cf4 \strokec4 ];\cb1 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 end\cf4 \strokec4  = \cf5 \strokec5 range\cf4 \strokec4 [\cf9 \strokec9 1\cf4 \strokec4 ];\cb1 \
\cb3     \cb1 \
\cb3     \cf2 \strokec2 for\cf4 \strokec4  (\cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 row\cf4 \strokec4  = \cf5 \strokec5 start\cf4 \strokec4 ; \cf5 \strokec5 row\cf4 \strokec4  <= \cf5 \strokec5 end\cf4 \strokec4 ; \cf5 \strokec5 row\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf5 \strokec5 fullList\cf4 \strokec4 .\cf5 \strokec5 push\cf4 \strokec4 (\cf5 \strokec5 col\cf4 \strokec4  + \cf5 \strokec5 row\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\cb3   \cf2 \strokec2 return\cf4 \strokec4  \cf5 \strokec5 fullList\cf4 \strokec4 ;\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf8 \cb3 \strokec8 // 3. 1\uc0\u38542 \u24109 \u12398 \u12300 \u31354 \u24109 \u12301 \u12522 \u12473 \u12488 \u12434 \u35336 \u31639 \u12375 \u12390 \u36820 \u12377 \u38306 \u25968 \cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 // (getAvailableTicketHtmlList \uc0\u12364 \u12371 \u12428 \u12434 \u21628 \u12403 \u20986 \u12381 \u12358 \u12392 \u12375 \u12390 \u12456 \u12521 \u12540 \u12395 \u12394 \u12387 \u12390 \u12356 \u12414 \u12377 )\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \strokec2 function\cf4 \strokec4  \cf5 \strokec5 getAvailableFirstFloorSeats\cf4 \strokec4 () \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf8 \strokec8 // \uc0\u12371 \u12398 \u38306 \u25968 \u12399 \u12525 \u12483 \u12463 \u65288 LockService\u65289 \u12434 \u20351 \u12356 \u12414 \u12379 \u12435 \u12290 \cf4 \cb1 \strokec4 \
\cb3   \cf8 \strokec8 // \uc0\u12394 \u12380 \u12394 \u12425 \u12289 \u12487 \u12540 \u12479 \u12434 \u26360 \u12365 \u25563 \u12360 \u12378 \u12289 \u35501 \u12415 \u21462 \u12427 \u12384 \u12369 \u12384 \u12363 \u12425 \u12391 \u12377 \u12290 \cf4 \cb1 \strokec4 \
\cb3   \cb1 \
\cb3   \cf2 \strokec2 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf8 \strokec8 // 1. 1\uc0\u38542 \u24109 \u12398 \u12300 \u12377 \u12409 \u12390 \u12398 \u24231 \u24109 \u12301 \u12522 \u12473 \u12488 \u12434 \u21462 \u24471 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 fullSeatList\cf4 \strokec4  = \cf5 \strokec5 generateFullSeatList\cf4 \strokec4 (); \cf8 \strokec8 // (\uc0\u19978 \u35352  2. \u12398 \u38306 \u25968 \u12434 \u21628 \u12403 \u20986 \u12375 )\cf4 \cb1 \strokec4 \
\cb3     \cb1 \
\cb3     \cf8 \strokec8 // 2. 1\uc0\u38542 \u24109 \u12398 \u12300 \u20104 \u32004 \u28168 \u12415 \u12301 \u12522 \u12473 \u12488 \u12434 \u21462 \u24471 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 reservedData\cf4 \strokec4  = \cf5 \strokec5 getReservedSeats\cf4 \strokec4 (); \cf8 \strokec8 // (\uc0\u26368 \u21021 \u12363 \u12425 \u12354 \u12427 \u38306 \u25968 )\cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 reservedSeats\cf4 \strokec4  = \cf5 \strokec5 reservedData\cf4 \strokec4 .\cf5 \strokec5 reservedSeats\cf4 \strokec4 ; \cb1 \
\
\cb3     \cf8 \strokec8 // 3. \uc0\u20104 \u32004 \u28168 \u12415 \u12522 \u12473 \u12488 \u12434 \u39640 \u36895 \u26908 \u32034 \u29992 \u12395 \u25972 \u24418 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 reservedSet\cf4 \strokec4  = \{\};\cb1 \
\cb3     \cf5 \strokec5 reservedSeats\cf4 \strokec4 .\cf5 \strokec5 forEach\cf4 \strokec4 (\cf2 \strokec2 function\cf4 \strokec4 (\cf5 \strokec5 seat\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 normalizedSeat\cf4 \strokec4  = \cf5 \strokec5 seat\cf4 \strokec4 .\cf5 \strokec5 toUpperCase\cf4 \strokec4 ().\cf5 \strokec5 replace\cf4 \strokec4 (\cf6 \strokec6 '-'\cf4 \strokec4 , \cf6 \strokec6 ''\cf4 \strokec4 ); \cf8 \strokec8 // 'D-6' -> 'D6'\cf4 \cb1 \strokec4 \
\cb3       \cf5 \strokec5 reservedSet\cf4 \strokec4 [\cf5 \strokec5 normalizedSeat\cf4 \strokec4 ] = \cf2 \strokec2 true\cf4 \strokec4 ;\cb1 \
\cb3     \});\cb1 \
\
\cb3     \cf8 \strokec8 // 4. (1)\uc0\u12363 \u12425 (2)\u12434 \u24341 \u12356 \u12390 \u12300 \u31354 \u24109 \u12301 \u12522 \u12473 \u12488 \u12434 \u20316 \u25104 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 var\cf4 \strokec4  \cf5 \strokec5 availableSeats\cf4 \strokec4  = \cf5 \strokec5 fullSeatList\cf4 \strokec4 .\cf5 \strokec5 filter\cf4 \strokec4 (\cf2 \strokec2 function\cf4 \strokec4 (\cf5 \strokec5 seat\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf2 \strokec2 return\cf4 \strokec4  !\cf5 \strokec5 reservedSet\cf4 \strokec4 [\cf5 \strokec5 seat\cf4 \strokec4 ];\cb1 \
\cb3     \});\cb1 \
\cb3     \cb1 \
\cb3     \cf8 \strokec8 // 5. \uc0\u25104 \u21151 \u12524 \u12473 \u12509 \u12531 \u12473 \u12434 \u36820 \u12377 \cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{\cb1 \
\cb3       \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'success'\cf4 \strokec4 ,\cb1 \
\cb3       \cf5 \strokec5 availableSeats\cf4 \strokec4 : \cf5 \strokec5 availableSeats\cf4 \strokec4  \cb1 \
\cb3     \};\cb1 \
\
\cb3   \} \cf2 \strokec2 catch\cf4 \strokec4  (\cf5 \strokec5 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf7 \strokec7 Logger\cf4 \strokec4 .\cf5 \strokec5 log\cf4 \strokec4 (\cf6 \strokec6 'getAvailableFirstFloorSeats \uc0\u12456 \u12521 \u12540 : '\cf4 \strokec4  + \cf5 \strokec5 e\cf4 \strokec4 .\cf5 \strokec5 message\cf4 \strokec4 );\cb1 \
\cb3     \cf2 \strokec2 return\cf4 \strokec4  \{ \cf5 \strokec5 status\cf4 \strokec4 : \cf6 \strokec6 'error'\cf4 \strokec4 , \cf5 \strokec5 message\cf4 \strokec4 : \cf6 \strokec6 '\uc0\u31354 \u24109 \u12522 \u12473 \u12488 \u12398 \u21462 \u24471 \u20013 \u12395 \u12456 \u12521 \u12540 \u12364 \u30330 \u29983 \u12375 \u12414 \u12375 \u12383 : '\cf4 \strokec4  + \cf5 \strokec5 e\cf4 \strokec4 .\cf5 \strokec5 message\cf4 \strokec4  \};\cb1 \
\cb3   \}\cb1 \
\cb3 \}\cb1 \
}